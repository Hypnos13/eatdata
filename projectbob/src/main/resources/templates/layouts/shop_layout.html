<!DOCTYPE html>
<html lang="ko" 
		xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Project BoB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/shopLayout.css">
    <link rel="stylesheet" href="/css/shopInfo.css">
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/shop.js}"></script>
    <script th:src="@{/js/menu.js}"></script>
    
</head>
<body>
    <div class="layout-wrapper">
    <!-- 헤더 fragment include -->

  	<th:block th:replace="~{fragments/shopHeader :: shopHeader}" />
	
    <div class="container-fluid">
	    <div class="d-flex flex-row">
	      <!-- 사이드바 -->
	      <aside class="services-sidebar me-4">
	        <!-- 사이드바: 가게 드롭다운 -->
			<div th:if="${shopListMain == null or #lists.isEmpty(shopListMain)}">
			  <button class="sidebar-menu-btn d-flex justify-content-between align-items-center">
			    아직 가게가 없습니다.
			  </button>
			</div>
			
			<div th:if="${shopListMain != null and !#lists.isEmpty(shopListMain)}" class="dropdown">
			  <button class="sidebar-menu-btn d-flex justify-content-between align-items-center dropdown-toggle w-100"
			        type="button" id="shopDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">
			  <span>
			    <span class="text-muted" th:text="'#' + (${currentShop != null ? currentShop.sId : shopListMain[0].sId})" style="font-size:0.97em;"></span>
			    <span class="fw-bold ms-1" th:text="${currentShop != null ? currentShop.name : shopListMain[0].name}">선택된 가게명</span>
			  </span>
			  <span>
			    <span th:if="${currentShop != null and currentShop.status == 'Y'}" class="badge bg-success ms-2">영업중</span>
			    <span th:if="${currentShop != null and currentShop.status != 'Y'}" class="badge bg-secondary ms-2">휴점</span>
			    <!-- shopListMain[0] fallback -->
			    <span th:if="${currentShop == null and shopListMain[0].status == 'Y'}" class="badge bg-success ms-2">영업중</span>
			    <span th:if="${currentShop == null and shopListMain[0].status != 'Y'}" class="badge bg-secondary ms-2">휴점</span>
			    <i class="bi bi-chevron-down ms-2"></i>
			  </span>
			</button>

			  <ul class="dropdown-menu" aria-labelledby="shopDropdownBtn">
			    <li th:each="shop, stat : ${shopListMain}">
			      <a class="dropdown-item d-flex align-items-center justify-content-between"
			         th:href="@{|/shopListMain?s_id=${shop.sId}|}">
			        <span>
        			<span class="text-muted" th:text="'#' + ${shop.sId}" style="font-size:0.97em;"></span>
			        <span class="ms-1" th:text="${shop.name}">가게이름</span>
			        </span>
			        <span th:if="${shop.status == 'Y'}" class="badge bg-success">영업중</span>
			        <span th:if="${shop.status != 'Y'}" class="badge bg-secondary">휴점</span>
			      </a>
			    </li>
			  </ul>
			</div>

        <!-- 아이콘 메뉴 리스트 -->
        <div class="sidebar-icon-list mb-3 mt-2">
		  <div class="row g-2">
		    <div class="col-4">
		      <a href="/orders" class="card text-center py-3 border-0 bg-light">
		        <i class="bi bi-receipt fs-3 text-primary"></i>
		        <div style="font-size:13px;">주문내역</div>
		      </a>
		    </div>
		    <div class="col-4">
		      <a href="#" class="card text-center py-3 border-0 bg-light position-relative" id="btn-new-notify">
			  <i class="bi bi-bell fs-3 text-warning"></i>
			  <div style="font-size:13px;">신규 배달</div>
			  <!-- 실시간 카운트 뱃지 -->
			  <span id="newNotifyBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none;">
			    0
			  </span>
			</a>
			
			<div class="dropdown-menu p-2" id="newNotifyMenu" style="min-width: 250px;">
			  <h6 class="dropdown-header">새로운 알림</h6>
			  <div id="newNotifyList">
			    <!-- JS 로 각 알림 항목을 <a class="dropdown-item" href="…">로 추가 -->
			    <p class="text-muted">알림이 없습니다.</p>
			  </div>
			</div>
			
		    </div>
		    <div class="col-4">
		      <a href="/delivery/assign" class="card text-center py-3 border-0 bg-light">
		        <i class="bi bi-people fs-3 text-success"></i>
		        <div style="font-size:13px;">배차 관리</div>
		      </a>
		    </div>
		    
		  </div>
		</div>
        
        <!-- 아이콘 메뉴 리스트 아래에 추가 -->
        <div class="sidebar-menu-group mt-3"
     		th:if="${shopListMain != null and !#lists.isEmpty(shopListMain)}">

	  <!-- 가게 관리 -->
	  <div class="mb-2">
	    <button class="btn w-100 text-start sidebar-group-btn fw-bold" 
	            data-bs-toggle="collapse" data-bs-target="#collapseStore" aria-expanded="false">
	      <i class="bi bi-shop me-2"></i> 가게 관리
	      <i class="bi bi-chevron-down float-end"></i>
	    </button>
	    <div class="collapse" id="collapseStore" th:if="${currentShop != null}" >
	      <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
	        <li th:if="${currentShop != null}">
			  <a class="sidebar-sub-link" th:href="@{|/shopBasicView?s_id=${currentShop.sId}|}">
			    기본 설정
			  </a>
			</li>
			<li th:if="${currentShop != null}">
			  <a class="sidebar-sub-link"
			     th:href="@{/shopNotice(s_id=${currentShop.sId})}">
			    가게 공지
			  </a>
			</li>
	      </ul>
	    </div>
	  </div>
	
	  <!-- 영업시간관리 -->
	  <div class="mb-2">
	    <button class="btn w-100 text-start sidebar-group-btn fw-bold"
	            data-bs-toggle="collapse" data-bs-target="#collapseTime" aria-expanded="false">
	      <i class="bi bi-clock-history me-2"></i> 영업시간 관리
	      <i class="bi bi-chevron-down float-end"></i>
	    </button>
	
	    <!-- currentShop 으로 바꿔주셔야 링크가 살아납니다 -->
	    <div class="collapse" id="collapseTime" th:if="${currentShop != null}">
	      <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
	        <li>
	          <a th:href="@{|/shopOpenTime?s_id=${currentShop.sId}|}"
	             class="sidebar-sub-link">
	            영업 시간
	          </a>
	        </li>
	        <li>
	          <a th:href="@{|/shopStatus?s_id=${currentShop.sId}|}"
	             class="sidebar-sub-link">
	            영업 상태
	          </a>
	        </li>
	      </ul>
	    </div>
	  </div>
	
	  <!-- 메뉴 관리 -->
	  <div class="mb-2">
	    <button class="btn w-100 text-start sidebar-group-btn fw-bold"
	            data-bs-toggle="collapse" data-bs-target="#collapseMenu" aria-expanded="false">
	      <i class="bi bi-list-check me-2"></i> 메뉴 관리
	      <i class="bi bi-chevron-down float-end"></i>
	    </button>
	    <div class="collapse" id="collapseMenu" th:if="${currentShop != null}" >
	      <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
		      <li><a th:href="@{|/shop/menuList?s_id=${currentShop.sId}|}" class="sidebar-sub-link">메뉴 리스트</a></li>
		      <li><a th:href="@{|/shop/menuRegisterForm?s_id=${currentShop.sId}|}" class="sidebar-sub-link">메뉴 등록</a></li>
	      </ul>
	    </div>
	   </div>
	  
		<!-- 리뷰관리 -->
		<div class="mb-2">
		  <button class="btn w-100 text-start sidebar-group-btn fw-bold"
		          data-bs-toggle="collapse" data-bs-target="#collapseReview" aria-expanded="false">
		    <i class="bi bi-chat-dots me-2"></i> 리뷰 관리
		    <i class="bi bi-chevron-down float-end"></i>
		  </button>
		  <!-- currentShop이 있을 때만 펼쳐집니다 -->
		  <div class="collapse" id="collapseReview" th:if="${currentShop != null}">
		    <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
		      <li>
			  <a th:href="@{|/shop/reviewManage?s_id=${currentShop.sId}|}"
			     class="sidebar-sub-link">
			    리뷰 관리
			  </a>
			</li>
		    </ul>
		  </div>
		</div>
		
		<!-- 통계 -->
		<div class="mb-2">
		  <button class="btn w-100 text-start sidebar-group-btn fw-bold"
		          data-bs-toggle="collapse" data-bs-target="#collapseStatMenu" aria-expanded="false">
		    <i class="bi bi-graph-up-arrow me-2"></i> 통계
		    <i class="bi bi-chevron-down float-end"></i>
		  </button>
		  <div class="collapse" id="collapseStatMenu">
		    <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
		      <li><a href="/stat/order" class="sidebar-sub-link">주문 통계</a></li>
		      <li><a href="/stat/review" class="sidebar-sub-link">리뷰 통계</a></li>
		      <li><a href="/stat/sales" class="sidebar-sub-link">매출 통계</a></li>
		    </ul>
		  </div>
		</div>
		
		<!-- 배달 관리 -->
     	<div class="mb-2">
        <button class="btn w-100 text-start sidebar-group-btn fw-bold"
                data-bs-toggle="collapse" data-bs-target="#collapseDelivery" aria-expanded="false">
          <i class="bi bi-truck me-2"></i> 배달 관리
          <i class="bi bi-chevron-down float-end"></i>
        </button>
        <div class="collapse" id="collapseDelivery">
          <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
            <li><a href="/delivery/new" class="sidebar-sub-link"><i class="bi bi-bell me-1"></i> 신규 배달</a></li>
            <li><a href="/delivery/assign" class="sidebar-sub-link"><i class="bi bi-people me-1"></i> 배차 관리</a></li>
            <li><a href="/delivery/map" class="sidebar-sub-link"><i class="bi bi-geo-alt me-1"></i> 라이더 위치</a></li>
            <li><a href="/delivery/history" class="sidebar-sub-link"><i class="bi bi-clock-history me-1"></i> 배달 내역</a></li>
          </ul>
        </div>
        </div>
		</div>
	  	</aside>
       
	      <!-- 본문 -->
	      <div class="main-content-outer">
			  <div class="content-card">
			    <main layout:fragment="content">
			      <!-- 자식 뷰 페이지의 본문이 들어옴 -->
			    </main>
			  </div>
			</div>
	    </div>
	</div>

    <!-- 푸터 fragment include -->
    <th:block th:replace="~{fragments/shopFooter :: shopFooter}" />

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </div>
</body>
</html>
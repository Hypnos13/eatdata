<!DOCTYPE html>
<html lang="ko" 
		xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>Project BoB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/shopLayout.css">
    <link rel="stylesheet" href="/css/shopInfo.css">
</head>
<body>
    <div class="layout-wrapper">
    <!-- 헤더 fragment include -->

  	<th:block th:replace="~{fragments/shopHeader :: shopHeader}" />
	
    <div class="container-fluid">
	    <div class="d-flex flex-row">
	      <!-- 사이드바 -->
	      <aside class="services-sidebar me-4">
	        <!-- 사이드바: 가게 드롭다운 -->
			<div th:if="${shopListMain == null or #lists.isEmpty(shopListMain)}">
			  <button class="sidebar-menu-btn d-flex justify-content-between align-items-center">
			    아직 가게가 없습니다.
			  </button>
			</div>
			
			<div th:if="${shopListMain != null and !#lists.isEmpty(shopListMain)}" class="dropdown">
			  <button class="sidebar-menu-btn d-flex justify-content-between align-items-center dropdown-toggle w-100"
			        type="button" id="shopDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">
			  <span>
			    <span class="text-muted" th:text="'#' + (${currentShop != null ? currentShop.sId : shopListMain[0].sId})" style="font-size:0.97em;"></span>
			    <span class="fw-bold ms-1" th:text="${currentShop != null ? currentShop.name : shopListMain[0].name}">선택된 가게명</span>
			  </span>
			  <span>
			    <span th:if="${currentShop != null and currentShop.status == 'Y'}" class="badge bg-success ms-2">Open</span>
			    <span th:if="${currentShop != null and currentShop.status != 'Y'}" class="badge bg-secondary ms-2">Close</span>
			    <!-- shopListMain[0] fallback -->
			    <span th:if="${currentShop == null and shopListMain[0].status == 'Y'}" class="badge bg-success ms-2">Open</span>
			    <span th:if="${currentShop == null and shopListMain[0].status != 'Y'}" class="badge bg-secondary ms-2">Close</span>
			    <i class="bi bi-chevron-down ms-2"></i>
			  </span>
			</button>

			  <ul class="dropdown-menu" aria-labelledby="shopDropdownBtn">
			    <li th:each="shop, stat : ${shopListMain}">
			      <a class="dropdown-item d-flex align-items-center justify-content-between"
			         th:href="@{|/shopListMain?s_id=${shop.sId}|}">
			        <span>
        			<span class="text-muted" th:text="'#' + ${shop.sId}" style="font-size:0.97em;"></span>
			        <span class="ms-1" th:text="${shop.name}">가게이름</span>
			        </span>
			        <span th:if="${shop.status == 'Y'}" class="badge bg-success">Open</span>
			        <span th:if="${shop.status != 'Y'}" class="badge bg-secondary">Close</span>
			      </a>
			    </li>
			  </ul>
			</div>

        <!-- 아이콘 메뉴 리스트 -->
        <div class="sidebar-icon-list mb-3 mt-2">
		  <div class="row g-2">
		    <div class="col-4">
		      <a href="/shop/orderManage?status=PENDING"
		         class="card text-center py-3 border-0 bg-light">
		        <i class="bi bi-bell fs-3 text-warning"></i>
		        <div style="font-size:13px;">신규 주문</div>
		      </a>
		    </div>
			<div class="col-4">
				<a href="/shop/orderManage?status=ALL"
				   class="card text-center py-3 border-0 bg-light">
				  <i class="bi bi-receipt fs-3 text-primary"></i>
				  <div style="font-size:13px;">주문 관리</div>
				</a>
			</div>
		    <div class="col-4">
		      <a href="/delivery/assign"
		         class="card text-center py-3 border-0 bg-light">
		        <i class="bi bi-people fs-3 text-success"></i>
		        <div style="font-size:13px;">배차 관리</div>
		      </a>
		    </div>
		  </div>
		</div>
        
        <!-- 아이콘 메뉴 리스트 아래에 추가 -->
        <div class="sidebar-menu-group mt-3"
     		th:if="${shopListMain != null and !#lists.isEmpty(shopListMain)}">

	  <!-- 가게 관리 -->
	  <div class="mb-2">
	    <button class="btn w-100 text-start sidebar-group-btn fw-bold" 
	            data-bs-toggle="collapse" data-bs-target="#collapseStore" aria-expanded="false">
	      <i class="bi bi-shop me-2"></i> 가게 관리
	      <i class="bi bi-chevron-down float-end"></i>
	    </button>
	    <div class="collapse" id="collapseStore" th:if="${currentShop != null}" >
	      <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
	        <li th:if="${currentShop != null}">
			  <a class="sidebar-sub-link" th:href="@{|/shopBasicView?s_id=${currentShop.sId}|}">
			    기본 설정
			  </a>
			</li>
			<li th:if="${currentShop != null}">
			  <a class="sidebar-sub-link"
			     th:href="@{/shopNotice(s_id=${currentShop.sId})}">
			    가게 공지
			  </a>
			</li>
			<li>
		      <a class="sidebar-sub-link"
		         th:href="@{|/shop/orders?s_id=${currentShop.sId}|}">
		        주문 내역
		      </a>
		    </li>
	      </ul>
	    </div>
	  </div>
	
	  <div class="mb-2" th:if="${currentShop != null}">
	  	<a th:href="@{|/shopOpenTime?s_id=${currentShop.sId}|}" class="btn w-100 text-start sidebar-group-btn fw-bold">
	  		<i class="bi bi-clock-history me-2"></i> 영업시간 관리
	  	</a>
	  </div>
	  
	  <div class="mb-2" th:if="${currentShop != null}">
  <a th:href="@{|/shop/delivery?s_id=${currentShop.sId}|}" class="btn w-100 text-start sidebar-group-btn fw-bold">
    <i class="bi bi-truck me-2"></i> 배달 관리
  </a>
</div>
	  
	  <div class="mb-2" th:if="${currentShop != null}">
	  	<a th:href="@{|/shop/menuList?s_id=${currentShop.sId}|}" class="btn w-100 text-start sidebar-group-btn fw-bold">
	  		<i class="bi bi-list-check me-2"></i> 메뉴 관리
	  	</a>
	  </div>
	  
	  <div class="mb-2" th:if="${currentShop != null}">
	  	<a th:href="@{|/shop/reviewManage?s_id=${currentShop.sId}|}" class="btn w-100 text-start sidebar-group-btn fw-bold">
	  		<i class="bi bi-chat-dots me-2"></i> 리뷰 관리
	  	</a>
	  </div>
		
		<!-- 주문 관리 추가
		<div class="mb-2">
		  <button class="btn w-100 text-start sidebar-group-btn fw-bold"
		          data-bs-toggle="collapse"
		          data-bs-target="#collapseOrderManage"
		          aria-expanded="false">
		    <i class="bi bi-list-check me-2"></i> 주문 관리
		    <i class="bi bi-chevron-down float-end"></i>
		  </button>
		  <div class="collapse" id="collapseOrderManage">
		    <ul class="list-unstyled ps-3 mb-0 sidebar-submenu">
		      <li>
		        <a th:href="@{/shop/orderManage(status='PENDING')}"
		           class="sidebar-sub-link">신규 주문</a>
		      </li>
		      <li>
		        <a th:href="@{/orders}"
		           class="sidebar-sub-link">주문 내역</a>
		      </li>
		    </ul>
		  </div>
		</div>		 -->
		
		</div>
	  	</aside>
       
	      <!-- 본문 -->
	      <div class="main-content-outer">
			  <div class="content-card">
			    <main layout:fragment="content">
			      <!-- 자식 뷰 페이지의 본문이 들어옴 -->
			    </main>
			  </div>
			</div>
	    </div>
	</div>

    <!-- 푸터 fragment include -->
    <th:block th:replace="~{fragments/shopFooter :: shopFooter}" />
	</div>
	<!-- 1) Bootstrap JS (팝업, 드롭다운 등) -->
	  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	  <!-- 2) jQuery (shop.js 안에서 사용한다면) -->
	  <script src="/js/jquery-3.7.1.min.js"></script>
	  <!-- 3) SockJS & STOMP -->
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
	  <!-- 4) 카카오맵 -->
	  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2b87d757b240dd70a51d682dd3cc37ed&libraries=services"></script>
	  <!-- 5) shop.js (WebSocket + 알림 로직) -->
	  <script th:src="@{/js/shop.js}"></script>
	  <!-- 6) 그 외 스크립트 -->
	  <script th:src="@{/js/menu.js}"></script>
	  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2b87d757b240dd70a51d682dd3cc37ed&libraries=services"></script>
</body>
</html>
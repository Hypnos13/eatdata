<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>BOB</title>
<link th:href="@{/bootstrap/bootstrap.min.css}" rel="stylesheet">
<link th:href="@{/css/main.css}" rel="stylesheet" />
<link rel="icon" th:href="@{/favicon.ico}" sizes="any">
<script th:src="@{/js/jquery-3.7.1.min.js}"></script>

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">


<!-- window.currentUserId 주입 코드 추가 -->
<script th:inline="javascript">
    /*<![CDATA[*/
   window.currentUserId = /*[[${#authentication.name}]]*/ null;
    console.log("main_layout.html: window.currentUserId : " + window.currentUserId);
    /*]]>*/
</script>

<!-- Toastify.js CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">


<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">

</head>
<body>
	<div th:replace="~{fragments/header::header}"></div>
	<div class="container">
		<div layout:fragment="content"></div>
	</div>
	<div th:replace="~{fragments/footer::footer}"></div>



	<script src="https://cdn.portone.io/v2/browser-sdk.js" async defer></script>


	<!-- 추가 메뉴 선택 모달 -->
	<div class="modal fade" id="addMenuModal" tabindex="-1"
		aria-labelledby="addMenuModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg">
			<div class="modal-content">

				<!-- 모달 헤더 -->
				<div class="modal-header">
					<h5 class="modal-title" id="addMenuModalLabel">추가 메뉴 선택</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="닫기"></button>
				</div>

				<!-- 모달 본문 -->
				<div class="modal-body">
					<div class="row">

						<!-- 메뉴 이미지 영역 -->
						<div class="col-md-4 text-center">
							<img id="modalMenuImage" src="" alt="메뉴 이미지"
								class="img-fluid rounded"
								style="max-height: 200px; object-fit: contain;">
						</div>

						<!-- 메뉴 정보 및 옵션 영역 -->
						<div class="col-md-8">
							<h4 id="modalMenuName" class="fw-bold mb-1"></h4>
							<p id="modalMenuInfo" class="text-muted"></p>
							<div id="modalMenuPrice" class="text-primary fw-semibold mb-2"></div>

							<!-- 숨은 필드 -->
							<input type="hidden" id="hiddenMenuPrice"> <input
								type="hidden" id="hiddenGuestId" value="">

							<hr>

							<!-- 추가 옵션 선택 -->
							<h6>추가 선택 옵션</h6>
							<div id="optionArea" class="mb-3">
						
							</div>

							<!-- 수량 조절 -->
							<div class="d-flex align-items-center mt-3">
								<label for="modalCount" class="me-3 fw-semibold"
									style="min-width: 50px;">수량</label>
								<button type="button" class="btn btn-outline-secondary btn-sm"
									id="btnCountMinus">-</button>
								<input type="text" id="modalCount" value="1" readonly
									class="form-control form-control-sm text-center mx-2"
									style="width: 60px;">
								<button type="button" class="btn btn-outline-secondary btn-sm"
									id="btnCountPlus">+</button>
							</div>

							<hr>
							<!-- 여기 라인 추가 -->

					<div id="nutritionInfo" class="mt-3">
    <h5>영양 성분</h5>

    <!-- 여기에 div.table-responsive 추가 -->
    <div class="table-responsive">
        <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
                <tr>
                    <th>열량 (kcal)</th>
                    <th>탄수화물 (g)</th>
                    <th>단백질 (g)</th>
                    <th>지방 (g)</th>
                    <th>포화지방 (g)</th>
                    <th>당 (g)</th>
                    <th>나트륨 (mg)</th>
                    <th>제공량 (g)</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="entry : ${menuCalMap}"
                    th:attr="data-mid=${entry.key}"
                    class="d-none">
                    <td th:text="${entry.value.calories}">-</td>
                    <td th:text="${entry.value.carbs}">-</td>
                    <td th:text="${entry.value.protein}">-</td>
                    <td th:text="${entry.value.fat}">-</td>
                    <td th:text="${entry.value.sfa}">-</td>
                    <td th:text="${entry.value.sugar}">-</td>
                    <td th:text="${entry.value.sodium}">-</td>
                    <td th:text="${entry.value.servingSize}">-</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

						</div>
					</div>
				</div>

				<!-- 모달 푸터 -->
				<div class="modal-footer">

					<button type="button" id="btnAddExtras" class="btn btn-primary">장바구니에
						추가</button>
				</div>

			</div>
		</div>
	</div>



	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=30a0d7b80b66b1135d1195c80899795d&libraries=services"></script>

<!-- Toastify.js JS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- SockJS and Stomp.js for WebSocket -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

	<script th:src="@{js/main.js}"></script>
	<script th:src="@{js/websocket.js}"></script>
	<script th:src="@{js/review.js}"></script>
	
	 <script>
      // ipapi.co를 통해 클라이언트 위치 조회
      fetch('https://ipapi.co/json/')
        .then(response => response.json())
        .then(data => {
          console.log("ipapi 위치 데이터:", data);

          // 위치 정보 보여주기
          const locInfo = `내 위치: ${data.city}, ${data.region}, ${data.country_name}`;
          document.getElementById('locationInfo').textContent = locInfo;

          // 카카오맵 생성 및 중심 좌표 설정
          const container = document.getElementById('map');
          const options = {
            center: new kakao.maps.LatLng(data.latitude, data.longitude),
            level: 4,
          };
          const map = new kakao.maps.Map(container, options);

          // 마커 표시
          const markerPosition = new kakao.maps.LatLng(data.latitude, data.longitude);
          const marker = new kakao.maps.Marker({ position: markerPosition });
          marker.setMap(map);
        })
        .catch(err => {
          console.error("위치 조회 실패:", err);
          document.getElementById('locationInfo').textContent = '위치 정보를 불러오는데 실패했습니다.';
        });
    </script>
    
	
	
</body>
</html>



<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>가상 라이더 - 신규 배차 요청</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2b87d757b240dd70a51d682dd3cc37ed&libraries=services"></script>
    <style>
    body { background-color: #343a40; color: white; }
    .card { background-color: #495057; border: 1px solid #6c757d; color: white; }
    .card-header { background-color: #212529; font-weight: bold; color: white; }
    .list-group-item { background-color: transparent; border-color: #6c757d; color: white; }
    .btn-accept { background-color: #28a745; color: white; font-weight: bold; border: none; }
    #map { width: 100%; height: 300px; border-radius: 0.375rem; }
    </style>
</head>
<body>
    <div class="container vh-100 d-flex align-items-center justify-content-center">
        <div class="card w-100" style="max-width: 600px;">
            <div class="card-header text-center fs-4">
                <i class="bi bi-bicycle"></i> 신규 배차 요청
            </div>
            <div class="card-body">
                <div id="map" class="mb-3"></div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <strong>주문 번호:</strong> <span id="orderId"></span>
                    </li>
                    <li class="list-group-item">
                        <strong>픽업지 (가게):</strong> <span id="shopAddress"></span><br>
                        <small class="text-white-50" id="shopPhone"></small>
                    </li>
                    <li class="list-group-item">
                        <strong>도착지 (고객):</strong> <span id="customerAddress"></span><br>
                        <small class="text-white-50" id="customerPhone"></small>
                    </li>
                    <li class="list-group-item">
                        <strong>픽업 예상 시간:</strong> <span id="pickupTime"></span>
                    </li>
                    <li class="list-group-item">
                        <strong>배달 완료 시간:</strong> <span id="deliveryTime"></span>
                    </li>
                </ul>
                <div class="d-grid mt-3">
                    <button class="btn btn-accept fs-5" id="btnAcceptDispatch">배차 수락</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. URL 파라미터에서 주문 정보 읽어오기
        const params = new URLSearchParams(window.location.search);
        const orderInfo = {
            orderId: params.get('orderId'),
            shopName: params.get('shopName'),
            shopAddress: params.get('shopAddress'),
            shopPhone: params.get('shopPhone'),
            customerAddress: params.get('customerAddress'),
            customerPhone: params.get('customerPhone'),
            pickupTime: params.get('pickupTime'),
            deliveryTime: params.get('deliveryTime')
        };

        // 2. 읽어온 정보로 페이지 내용 채우기
        document.getElementById('orderId').textContent = orderInfo.orderId;
        document.getElementById('shopAddress').textContent = orderInfo.shopAddress;
        document.getElementById('shopPhone').textContent = `📞 ${orderInfo.shopPhone}`;
        document.getElementById('customerAddress').textContent = orderInfo.customerAddress;
        document.getElementById('customerPhone').textContent = `📞 ${orderInfo.customerPhone}`;
        document.getElementById('pickupTime').textContent = orderInfo.pickupTime;
        document.getElementById('deliveryTime').textContent = orderInfo.deliveryTime;

        // 3. 카카오맵 초기화
        const mapContainer = document.getElementById('map');
        const map = new kakao.maps.Map(mapContainer, {
            center: new kakao.maps.LatLng(37.566826, 126.9786567), level: 3
        });
        const geocoder = new kakao.maps.services.Geocoder();

        // 가게 마커
        geocoder.addressSearch(orderInfo.shopAddress, function(result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                new kakao.maps.Marker({ map: map, position: coords, title: orderInfo.shopName });
                map.setCenter(coords);
            }
        });
        // 고객 마커
        geocoder.addressSearch(orderInfo.customerAddress, function(result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                const image = new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', new kakao.maps.Size(64, 69), {offset: new kakao.maps.Point(27, 69)});
                new kakao.maps.Marker({ map: map, position: coords, title: '고객', image: image });
            }
        });
        
        // 4. '배차 수락' 버튼 클릭 이벤트
        document.getElementById('btnAcceptDispatch').addEventListener('click', function() {
            // (나중에 이 부분에 웹소켓으로 '수락' 신호를 보내는 코드가 들어갑니다)
            alert(`주문번호 ${orderInfo.orderId}의 배차를 수락했습니다!`);
            this.disabled = true;
            this.textContent = "픽업하러 이동 중...";
        });
    });
    </script>
</body>
</html>
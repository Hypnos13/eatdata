<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°€ìƒ ë¼ì´ë” - ì‹ ê·œ ë°°ì°¨ ìš”ì²­</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2b87d757b240dd70a51d682dd3cc37ed&libraries=services"></script>
    <style>
    body { background-color: #343a40; color: white; }
    .card { background-color: #495057; border: 1px solid #6c757d; color: white; }
    .card-header { background-color: #212529; font-weight: bold; color: white; }
    .list-group-item { background-color: transparent; border-color: #6c757d; color: white; }
    .btn-accept { background-color: #28a745; color: white; font-weight: bold; border: none; }
    #map { width: 100%; height: 300px; border-radius: 0.375rem; }
    </style>
</head>
<body>
    <div class="container vh-100 d-flex align-items-center justify-content-center">
        <div class="card w-100" style="max-width: 600px;">
            <div class="card-header text-center fs-4">
                <i class="bi bi-bicycle"></i> ì‹ ê·œ ë°°ì°¨ ìš”ì²­
            </div>
            <div class="card-body">
                <div id="map" class="mb-3"></div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <strong>ì£¼ë¬¸ ë²ˆí˜¸:</strong> <span id="orderId"></span>
                    </li>
                    <li class="list-group-item">
                        <strong>í”½ì—…ì§€ (ê°€ê²Œ):</strong> <span id="shopAddress"></span><br>
                        <small class="text-white-50" id="shopPhone"></small>
                    </li>
                    <li class="list-group-item">
                        <strong>ë„ì°©ì§€ (ê³ ê°):</strong> <span id="customerAddress"></span><br>
                        <small class="text-white-50" id="customerPhone"></small>
                    </li>
                    <li class="list-group-item">
                        <strong>í”½ì—… ì˜ˆìƒ ì‹œê°„:</strong> <span id="pickupTime"></span>
                    </li>
                    <li class="list-group-item">
                        <strong>ë°°ë‹¬ ì™„ë£Œ ì‹œê°„:</strong> <span id="deliveryTime"></span>
                    </li>
                </ul>
                <div class="d-grid mt-3">
                    <button class="btn btn-accept fs-5" id="btnAcceptDispatch">ë°°ì°¨ ìˆ˜ë½</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. URL íŒŒë¼ë¯¸í„°ì—ì„œ ì£¼ë¬¸ ì •ë³´ ì½ì–´ì˜¤ê¸°
        const params = new URLSearchParams(window.location.search);
        const orderInfo = {
            orderId: params.get('orderId'),
            shopName: params.get('shopName'),
            shopAddress: params.get('shopAddress'),
            shopPhone: params.get('shopPhone'),
            customerAddress: params.get('customerAddress'),
            customerPhone: params.get('customerPhone'),
            pickupTime: params.get('pickupTime'),
            deliveryTime: params.get('deliveryTime')
        };

        // 2. ì½ì–´ì˜¨ ì •ë³´ë¡œ í˜ì´ì§€ ë‚´ìš© ì±„ìš°ê¸°
        document.getElementById('orderId').textContent = orderInfo.orderId;
        document.getElementById('shopAddress').textContent = orderInfo.shopAddress;
        document.getElementById('shopPhone').textContent = `ğŸ“ ${orderInfo.shopPhone}`;
        document.getElementById('customerAddress').textContent = orderInfo.customerAddress;
        document.getElementById('customerPhone').textContent = `ğŸ“ ${orderInfo.customerPhone}`;
        document.getElementById('pickupTime').textContent = orderInfo.pickupTime;
        document.getElementById('deliveryTime').textContent = orderInfo.deliveryTime;

        // 3. ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™”
        const mapContainer = document.getElementById('map');
        const map = new kakao.maps.Map(mapContainer, {
            center: new kakao.maps.LatLng(37.566826, 126.9786567), level: 3
        });
        const geocoder = new kakao.maps.services.Geocoder();

        // ê°€ê²Œ ë§ˆì»¤
        geocoder.addressSearch(orderInfo.shopAddress, function(result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                new kakao.maps.Marker({ map: map, position: coords, title: orderInfo.shopName });
                map.setCenter(coords);
            }
        });
        // ê³ ê° ë§ˆì»¤
        geocoder.addressSearch(orderInfo.customerAddress, function(result, status) {
            if (status === kakao.maps.services.Status.OK && result.length > 0) {
                const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                const image = new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', new kakao.maps.Size(64, 69), {offset: new kakao.maps.Point(27, 69)});
                new kakao.maps.Marker({ map: map, position: coords, title: 'ê³ ê°', image: image });
            }
        });
        
        // 4. 'ë°°ì°¨ ìˆ˜ë½' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('btnAcceptDispatch').addEventListener('click', function() {
            // (ë‚˜ì¤‘ì— ì´ ë¶€ë¶„ì— ì›¹ì†Œì¼“ìœ¼ë¡œ 'ìˆ˜ë½' ì‹ í˜¸ë¥¼ ë³´ë‚´ëŠ” ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤)
            alert(`ì£¼ë¬¸ë²ˆí˜¸ ${orderInfo.orderId}ì˜ ë°°ì°¨ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤!`);
            this.disabled = true;
            this.textContent = "í”½ì—…í•˜ëŸ¬ ì´ë™ ì¤‘...";
        });
    });
    </script>
</body>
</html>
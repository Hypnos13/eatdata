<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<header th:fragment="shopHeader" class="header">
  <div class="d-flex align-items-center">
    <a href="/shopMain" class="logo">Project BoB</a>
    <a href="/shopListMain" class="header-home-link ms-3 fw-semibold">서비스 홈</a>
    <span class="ms-3 fw-semibold page-title-text">
      <span th:text="${pageTitle} ?: 'Project BoB'">현재 페이지명</span>
    </span>
  </div>
  <nav class="d-flex align-items-center">
    <!-- 로그인 상태일 때 -->
    <th:block th:if="${session.isLogin}">
      <!-- 알림 아이콘 + 뱃지 -->
      <div id="notifyContainer"
           th:attr="data-shop-id=${currentShop.sId}"
           class="position-relative me-3 dropdown">
        <a href="#" id="headerNotifyBtn" data-bs-toggle="dropdown" aria-expanded="false">
          <i id="notifyIcon" class="bi bi-bell-fill fs-4"></i>
        </a>
        <span id="header-notif-badge"
              th:text="${session.notifyCount}"
              class="badge bg-danger position-absolute top-0 start-100 translate-middle p-1"
              th:classappend="${session.notifyCount == 0} ? 'd-none' : ''">
        </span>
        <!-- 드롭다운 메뉴 -->
		<ul id="header-notif-list"
		    class="dropdown-menu dropdown-menu-start p-2"
		    aria-labelledby="headerNotifyBtn">
		  <li>
		    <h6 class="dropdown-header">새로운 알림</h6>
		  </li>
		  <!-- 알림이 없을 때 -->
		  <li th:if="${#lists.isEmpty(notifications)}"
		      class="text-muted mb-0">
		    알림이 없습니다.
		  </li>
		  <!-- 알림 리스트 반복 -->
		  <li th:each="n : ${notifications}"
		    class="notif-item d-flex justify-content-between align-items-center"
		    th:attr="data-order-no=${n.orderId}">
		  <a class="dropdown-item flex-grow-1 text-truncate"
		     th:href="@{|/shop/orderDetail?oNo=${n.orderId}|}">
		    <span>새 주문이 도착했습니다.</span>
		  </a>
		  <span class="d-flex flex-column align-items-end ms-2" style="min-width:60px;">
		    <span class="text-danger small">
		      <span id="hdr-countdown-[[${n.orderId}]]"
				      class="timer"
				      th:attr="data-expiry=${n.timestamp + 180000}">--:--</span>
		    </span>
		    <div class="progress" style="width:55px; height: 5px; margin-top: 2px;">
		      <div id="hdr-progress-[[${n.orderId}]]"
		           class="progress-bar bg-danger"
		           role="progressbar"
		           style="width:100%;"
		           aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
		      </div>
		    </div>
		  </span>
		</li>
		</ul>
      </div>
      <a class="me-2 fw-bold" th:text="${session.loginNickname} + ' 님 어서오세요.'">
        홍길동 님 어서오세요.
      </a>
      <a href="/logout" class="btn-login">로그아웃</a>
      <a href="myProfile" class="btn-login">내정보수정</a>
    </th:block>

    <!-- 비로그인 상태 -->
    <th:block th:unless="${session.isLogin}">
      <a href="login?from=owner" class="btn-login">로그인</a>
    </th:block>

    <!-- master 권한일 때만 -->
    <th:block th:if="${session.loginDivision == 'master'}">
      <a href="faqList" class="btn-register">FAQ관리</a>
      <a href="noticeList" class="btn-register">공지사항관리</a>
      <a href="userList" class="btn-register">사용자관리</a>
      <a href="shopManage" class="btn-register">가게관리</a>
    </th:block>
  </nav>
</header>
</html>

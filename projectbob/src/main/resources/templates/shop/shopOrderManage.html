<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/shop_layout}">
<head>
<meta charset="UTF-8">
<title>ì£¼ë¬¸ ê´€ë¦¬</title>
<style>
  /* â”€â”€â”€ ë ˆì´ì•„ì›ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
  --theme-color: #43D091;
}
  .main-container { display: flex; height: calc(100vh - 70px); 
  }
  .order-detail-box {
  background: #ffffff;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1rem;
}
  .order-list-panel {
    width: 360px;
    background: var(--light-color);
    border-right:1px solid #dee2e6;
    display:flex;
    flex-direction:column;
  }
  .order-list-header {
    padding:1rem;
    font-weight:bold;
    color: var(--dark-color);
    border-bottom:1px solid #dee2e6;
  	display: flex;
  	align-items: center;
  }
  .btn-group.w-100 .btn {
    flex:1;
    font-size:.9rem;
    border-color: var(--main-color);
  }
  .btn-group.w-100 .btn-primary {
    background: var(--main-color);
    border-color: var(--main-color);
    color: var(--light-color);
  }
  .btn-group.w-100 .btn-outline-primary {
    color: var(--main-color);
  }

  .order-list-header .badge {
     margin-left: auto;
   }
  .order-list { overflow-y:auto; flex-grow:1; 
  }
  .order-card {
    padding:.75rem 1rem;
    border-bottom:1px solid #e9ecef;
    cursor:pointer;
    transition:background .2s;
    display:block;
    color: inherit;
  }
  .order-card:hover { background:#f8f9fa; }
  .order-card.active {
    background:#e6f9f2;
    border-left:4px solid var(--main-color);
  }
  .order-card-title { font-weight:bold; display:flex; justify-content:space-between; }
  .order-card-detail { font-size:.9rem; color:#495057; margin-top:.25rem; }

  .order-detail-panel {
    flex-grow:1;
    padding:1.5rem;
    background: var(--light-gray);
    overflow-y:auto;
  }

  /* â”€â”€â”€ íƒ€ì„ë¼ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.status-steps {
  display: flex;
  margin: 1rem 0;
  padding: 0 1.5rem;           /* â† ì¢Œìš° ì—¬ë°± ì¡°ì • */
  list-style: none;
  background: #fff;
  border: 1px solid #dee2e6;
  border-radius: 8px;
}

  .status-steps li {
  position: relative;
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem 0.5rem;
  z-index: 1;                  /* ì„ ë³´ë‹¤ ìœ„ì— */
}

/* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.status-steps li i {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
  color: #ccc;
  position: relative;
  z-index: 1;
}

/* ì™„ë£Œëœ ë‹¨ê³„ ê°•ì¡° */
.status-steps li.completed i {
  color: var(--theme-color);
}

/* ê° ë‹¨ê³„ ì‚¬ì´ì˜ ì„  */
.status-steps li + li::before {
  content: '';
  position: absolute;
  /* ì•„ì´ì½˜ íŒ¨ë”©(1rem) + ì•„ì´ì½˜ ë†’ì´(1.5rem)ì˜ ì ˆë°˜ */
  top: 1.75rem;
  left: -50%;
  width: 100%;
  height: 2px;
  background: #ccc;
  z-index: -1;
  transform: none;
}

  /* â”€â”€â”€ ì£¼ë¬¸ ì •ë³´ ì¹´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .order-info-card {
	  background: var(--light-color);
	  border: 1px solid #dee2e6;
	  border-radius: 12px;
	  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
	  margin: 1rem 0;          /* ìœ„ì•„ë˜ ì—¬ë°± ìœ ì§€ */
	  margin-left: auto;         /* ì¢Œì¸¡ ì—¬ë°± ìë™ìœ¼ë¡œ ì±„ì›Œì„œ ìš°ì¸¡ ì •ë ¬ */
	  max-width: 600px;          /* ë„ˆë¬´ ë„“ì§€ ì•Šë„ë¡ ì œí•œ */
	  overflow: hidden;
	}
  .order-info-card .card-header {
    background: transparent;
    border-bottom: 1px solid #dee2e6;
    padding: 0.5rem 0.75rem;
  }
  .order-info-card .card-header h5 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-color);
    margin: 0;
  }
  .order-info-card .list-group-item {
    border: none;
    border-bottom: 1px solid #eee;
    padding: 0.5rem 0.75rem;
    display: flex;
    align-items: center;
  }
  .order-info-card .list-group-item:last-child { border-bottom: none; }
  .order-info-card .list-group-item i.fs-5 {
    width: 1.5rem;
    text-align: center;
    margin-right: 0.5rem;
    color: #6c757d;
  }
  .order-info-card .list-group-item > .flex-grow-1 {
    flex: 1;
    color: var(--text-color);
  }
  .order-info-card .list-group-item .fw-bold,
  .order-info-card .list-group-item .text-end {
    font-weight: 600;
    color: var(--dark-color);
  }
  .order-detail-box--info .order-info-card {
     width: 100%;
     max-width: none;   /* ê¸°ì¡´ max-width:600px ë¬´ì‹œ */
     margin: 0;         /* margin-left:auto ì œê±° */
  }
  .order-detail-box--info .list-group-item {
  border: none;
  border-bottom: 1px solid #eee;
}
  .order-detail-box--info .list-group-item:last-child {
  border-bottom: none;
}
.order-detail-box--info h5 {
  margin-bottom: .75rem;
}
  @media (max-width:576px) {
    .order-info-card .list-group-item {
      flex-wrap: wrap;
      text-align: left;
    }
    .order-info-card .list-group-item > .flex-grow-1,
    .order-info-card .list-group-item .fw-bold,
    .order-info-card .list-group-item .text-end {
      width: 100%;
      margin-bottom: .25rem;
    }
  }

  /* â”€â”€â”€ ìƒíƒœ ë³€ê²½ ë²„íŠ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .order-detail-panel .btn-group .btn {
    font-size: .95rem;
    padding: .5rem 1.2rem;
    border-radius: 4px;
    box-shadow: none;
  }
  .order-detail-panel .btn-warning {
    background: #f0ad4e;
    border-color: #eea236;
    color: #fff;
  }
  .order-detail-panel .btn-success {
    background: var(--main-color);
    border-color: var(--main-color);
    color: var(--light-color);
  }
  .order-detail-box--actions .btn-group {
  display: flex;
  width: 100%;
}
  .order-detail-box--actions .btn-group .btn {
  flex: 1;
  margin: 0; 
}
.order-detail-box--actions .btn-group .btn + .btn {
  margin-left: 0.5rem;
}
</style>
</head>
<body>
	<th:block layout:fragment="content">
	  <div class="main-container">
	    
	    <!-- ì¢Œì¸¡: ìƒíƒœ í•„í„° & ë¦¬ìŠ¤íŠ¸ -->
	    <div class="order-list-panel">
	      <div class="order-list-header">
	        <i class="bi bi-receipt"></i>
	        ì£¼ë¬¸ ê´€ë¦¬
	      <span class="badge bg-primary rounded-pill" th:text="${#lists.size(orders)}">0</span>
	      </div>
	      
	      
	      <div class="btn-group w-100 mb-2">
	        <a th:href="@{/shop/orderManage(status='ACCEPTED')}"
	           th:classappend="${status=='ACCEPTED'}?'btn-primary':'btn-outline-primary'"
	           class="btn">ğŸ³ ì¡°ë¦¬ ì¤‘</a>
	        <a th:href="@{/shop/orderManage(status='DELIVERING')}"
	           th:classappend="${status=='DELIVERING'}?'btn-primary':'btn-outline-primary'"
	           class="btn">ğŸšš ë°°ë‹¬ ì¤‘</a>
	        <a th:href="@{/shop/orderManage(status='COMPLETED')}"
	           th:classappend="${status=='COMPLETED'}?'btn-primary':'btn-outline-primary'"
	           class="btn">âœ… ì™„ë£Œ</a>
	      </div>
	      <div class="order-list">
	        <div th:if="${#lists.isEmpty(orders)}"
	             class="text-center text-muted p-4">
	          ì¡°íšŒëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.
	        </div>
	        <a th:each="o,iter : ${orders}"
	           th:href="@{|/shop/orderManage?status=${status}&oNo=${o.oNo}|}"
	           class="order-card"
	           th:classappend="(selectedOrder?.oNo == o.oNo) or (selectedOrder==null and iter.index==0) ? ' active'">
	          <div class="order-card-title">
	            <span>ì£¼ë¬¸ë²ˆí˜¸ <span th:text="${o.oNo}"></span></span>
	            <span th:text="${o.payment}"></span>
	          </div>
	          <div class="order-card-detail">
	            <div th:text="${#dates.format(o.regDate,'yyyy-MM-dd HH:mm')}"></div>
	            <div th:text="${o.oAddress}"></div>
	          </div>
	        </a>
	      </div>
	    </div>
	    
	    <!-- ìš°ì¸¡ ìƒì„¸ íŒ¨ë„ -->
	    <div class="order-detail-panel">
			
			<!-- ì£¼ë¬¸ ì„ íƒ ì‹œ -->
		  	<th:block th:if="${selectedOrder != null}">
	        
	        <!-- 1. ì£¼ë¬¸ë²ˆí˜¸ & ìƒë‹¨ì •ë³´ -->
			<div class="order-detail-box order-detail-box--header">
			  <div class="d-flex justify-content-between">
			    <!-- ì¢Œì¸¡: ì£¼ë¬¸ë²ˆí˜¸, ì£¼ì†ŒÂ·ìˆ˜ëŸ‰ -->
			    <div>
			      <h4 class="mb-1">
			        ì£¼ë¬¸ë²ˆí˜¸ <span th:text="${selectedOrder.oNo}"></span>
			      </h4>
			      <div class="text-muted">
			        <span th:text="${selectedOrder.oAddress}">ì„œìš¸ ê°•ë‚¨êµ¬</span>
				</div>
			    </div>
			    <!-- ìš°ì¸¡: ì£¼ë¬¸ì¼ì‹œ, ë°°ë‹¬/í”½ì—… -->
			    <div class="text-end">
			      <div class="text-muted mb-1"
			           th:text="${#dates.format(selectedOrder.regDate,'yyyy-MM-dd HH:mm')}">
			        2025-08-06 12:34
			      </div>
			      <div class="fw-bold"
			           th:text="${selectedOrder.oAddress != null ? 'ë°°ë‹¬' : 'í”½ì—…'}">
			        ë°°ë‹¬
			      </div>
			    </div>
			  </div>
			</div>

	        <!-- 2. íƒ€ì„ë¼ì¸ -->
		    <div class="order-detail-section timeline">
		      <ul class="status-steps">
				  <li th:classappend="${#lists.contains({'ACCEPTED','DISPATCHED','DELIVERING','COMPLETED'},selectedOrder.status)} ? 'completed'">
				    <i class="bi bi-clock-fill"></i>
				    <span>ì¡°ë¦¬ ì¤‘</span>
				  </li>
				  <li th:classappend="${#lists.contains({'DISPATCHED','DELIVERING','COMPLETED'},selectedOrder.status)} ? 'completed'">
				    <i class="bi bi-box-seam"></i>
				    <span>ë°°ì°¨ ì™„ë£Œ</span>
				  </li>
				  <li th:classappend="${#lists.contains({'DELIVERING','COMPLETED'},selectedOrder.status)} ? 'completed'">
				    <i class="bi bi-truck"></i>
				    <span>ë°°ë‹¬ ì¤‘</span>
				  </li>
				  <li th:classappend="${selectedOrder.status=='COMPLETED'} ? 'completed'">
				    <i class="bi bi-check-circle-fill"></i>
				    <span>ì™„ë£Œ</span>
				  </li>
				</ul>
		    </div>

	        <!-- 3. ì£¼ë¬¸ì •ë³´ -->
	        <div class="order-detail-box order-detail-box--info">
			  <ul class="list-group list-group-flush mt-2">
			    <!-- ë©”ë‰´ -->
			    <li class="list-group-item d-flex align-items-center py-2">
			    <i class="text-secondary me-3 fs-5"></i>
				   <div class="flex-shrink-1">ë©”ë‰´</div>
				  <div class="flex-grow-1 text-end"
				       th:utext="${#strings.replace(selectedOrder.menus, ',', '<br/>')}">
			        <!-- ì˜ˆì‹œ: ì¹˜í‚¨ *1<br/>ì½œë¼ *1 -->
			      </div>
			    </li>
			    <!-- ì´ì•¡ -->
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">ì´ì•¡</div>
			      <div class="fw-bold" th:text="${selectedOrder.totalPrice + 'ì›'}">
			        32,500ì›
			      </div>
			    </li>
			    <!-- ìš”ì²­ì‚¬í•­ -->
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">ìš”ì²­ì‚¬í•­</div>
			      <div class="fw-bold" th:text="${selectedOrder.request ?: 'ì—†ìŒ'}">
			        ë²¨ ëˆŒëŸ¬ì£¼ì„¸ìš”
			      </div>
			    </li>
			  </ul>
			</div>
		
			<!-- 4. ë²„íŠ¼ -->
		    <div class="order-detail-box order-detail-box--actions"
					th:if="${selectedOrder.status != 'COMPLETED'}">
		      <div class="btn-group">
		        <button
		          th:if="${selectedOrder.status=='ACCEPTED' or selectedOrder.status=='DISPATCHED'}"
		          class="btn btn-warning me-2"
		          th:onclick="|location.href='@{/shop/orderManage/{oNo}/status(oNo=${selectedOrder.oNo},newStatus=DELIVERING)}'|">
		          ğŸšš ë°°ë‹¬ ì‹œì‘
		        </button>
		        <button
		          th:if="${selectedOrder.status=='DELIVERING'}"
		          class="btn btn-success"
		          th:onclick="|location.href='@{/shop/orderManage/{oNo}/status(oNo=${selectedOrder.oNo},newStatus=COMPLETED)}'|">
		          âœ… ë°°ë‹¬ ì™„ë£Œ
		        </button>
		      </div>
		    </div>
		
		  </th:block>

	      <!-- ì£¼ë¬¸ ë¯¸ì„ íƒ ì‹œ -->
		  <th:block th:if="${selectedOrder == null}">
		    <div class="text-center text-muted p-5">
		      ì™¼ìª½ì—ì„œ ì£¼ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”.
		    </div>
		  </th:block>

	    </div>
		
	  </div>
	</th:block>
</body>
</html>

<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/shop_layout}">
<head>
<meta charset="UTF-8">
<title>주문 관리</title>
<style>
  /* ─── 레이아웃 ─────────────────────────────── */
  .main-container { display: flex; height: calc(100vh - 70px); }
  .order-list-panel {
    width: 360px;
    background: var(--light-color);
    border-right:1px solid #dee2e6;
    display:flex;
    flex-direction:column;
  }
  .order-list-header {
    padding:1rem;
    font-weight:bold;
    color: var(--dark-color);
    border-bottom:1px solid #dee2e6;
  }
  .btn-group.w-100 .btn {
    flex:1;
    font-size:.9rem;
    border-color: var(--main-color);
  }
  .btn-group.w-100 .btn-primary {
    background: var(--main-color);
    border-color: var(--main-color);
    color: var(--light-color);
  }
  .btn-group.w-100 .btn-outline-primary {
    color: var(--main-color);
  }

  .order-list { overflow-y:auto; flex-grow:1; }
  .order-card {
    padding:.75rem 1rem;
    border-bottom:1px solid #e9ecef;
    cursor:pointer;
    transition:background .2s;
    display:block;
    color: inherit;
  }
  .order-card:hover { background:#f8f9fa; }
  .order-card.active {
    background:#e6f9f2;
    border-left:4px solid var(--main-color);
  }
  .order-card-title { font-weight:bold; display:flex; justify-content:space-between; }
  .order-card-detail { font-size:.9rem; color:#495057; margin-top:.25rem; }

  .order-detail-panel {
    flex-grow:1;
    padding:1.5rem;
    background: var(--light-gray);
    overflow-y:auto;
  }

  /* ─── 타임라인 ───────────────────────────── */
  .status-steps {
    display:flex;
    counter-reset:step;
    margin:1rem 0;
    list-style:none;
    padding:0;
  }
  .status-steps li {
    position:relative;
    flex:1;
    text-align:center;
  }
  .status-steps li:before {
    counter-increment:step;
    content:counter(step);
    width:2rem; height:2rem; line-height:2rem;
    border:2px solid #ccc;
    border-radius:50%;
    background: var(--light-color);
    margin:0 auto;
    z-index:1;
  }
  .status-steps li:after {
    content:'';
    position:absolute;
    width:100%; height:2px;
    background:#ccc;
    top:1rem; left:-50%;
    z-index:0;
  }
  .status-steps li:first-child:after { display:none; }
  .status-steps li.completed:before,
  .status-steps li.completed:after {
    background: var(--main-color);
    border-color: var(--main-color);
  }
  .status-steps li span {
    display:block;
    margin-top:.5rem;
    font-size:.9rem;
    color: var(--dark-color);
  }

  /* ─── 주문 정보 카드 ───────────────────────── */
  .order-info-card {
	  background: var(--light-color);
	  border: 1px solid #dee2e6;
	  border-radius: 12px;
	  box-shadow: 0 1px 6px rgba(0,0,0,0.04);
	  margin: 1rem 0;          /* 위아래 여백 유지 */
	  margin-left: auto;         /* 좌측 여백 자동으로 채워서 우측 정렬 */
	  max-width: 600px;          /* 너무 넓지 않도록 제한 */
	  overflow: hidden;
	}
  .order-info-card .card-header {
    background: transparent;
    border-bottom: 1px solid #dee2e6;
    padding: 0.5rem 0.75rem;
  }
  .order-info-card .card-header h5 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark-color);
    margin: 0;
  }
  .order-info-card .list-group-item {
    border: none;
    border-bottom: 1px solid #eee;
    padding: 0.5rem 0.75rem;
    display: flex;
    align-items: center;
  }
  .order-info-card .list-group-item:last-child { border-bottom: none; }
  .order-info-card .list-group-item i.fs-5 {
    width: 1.5rem;
    text-align: center;
    margin-right: 0.5rem;
    color: #6c757d;
  }
  .order-info-card .list-group-item > .flex-grow-1 {
    flex: 1;
    color: var(--text-color);
  }
  .order-info-card .list-group-item .fw-bold,
  .order-info-card .list-group-item .text-end {
    font-weight: 600;
    color: var(--dark-color);
  }
  @media (max-width:576px) {
    .order-info-card .list-group-item {
      flex-wrap: wrap;
      text-align: left;
    }
    .order-info-card .list-group-item > .flex-grow-1,
    .order-info-card .list-group-item .fw-bold,
    .order-info-card .list-group-item .text-end {
      width: 100%;
      margin-bottom: .25rem;
    }
  }

  /* ─── 상태 변경 버튼 ───────────────────────── */
  .order-detail-panel .btn-group .btn {
    font-size: .95rem;
    padding: .5rem 1.2rem;
    border-radius: 4px;
    box-shadow: none;
  }
  .order-detail-panel .btn-warning {
    background: #f0ad4e;
    border-color: #eea236;
    color: #fff;
  }
  .order-detail-panel .btn-success {
    background: var(--main-color);
    border-color: var(--main-color);
    color: var(--light-color);
  }
</style>
</head>
<body>
	<th:block layout:fragment="content">
	  <div class="content-card">
	  <div class="main-container">
	    
	    <!-- 좌측: 상태 필터 & 리스트 -->
	    <div class="order-list-panel">
	      <div class="order-list-header">
	        <i class="bi bi-receipt"></i>
	        주문 관리
	        
	      </div>
	      <div class="btn-group w-100 mb-2">
	        <a th:href="@{/shop/orderManage(status='ACCEPTED')}"
	           th:classappend="${status=='ACCEPTED'}?'btn-primary':'btn-outline-primary'"
	           class="btn">🍳 조리 중</a>
	        <a th:href="@{/shop/orderManage(status='DELIVERING')}"
	           th:classappend="${status=='DELIVERING'}?'btn-primary':'btn-outline-primary'"
	           class="btn">🚚 배달 중</a>
	        <a th:href="@{/shop/orderManage(status='COMPLETED')}"
	           th:classappend="${status=='COMPLETED'}?'btn-primary':'btn-outline-primary'"
	           class="btn">✅ 완료</a>
	      </div>
	      <div class="order-list">
	        <div th:if="${#lists.isEmpty(orders)}"
	             class="text-center text-muted p-4">
	          조회된 주문이 없습니다.
	        </div>
	        <a th:each="o,iter : ${orders}"
	           th:href="@{|/shop/orderManage?status=${status}&oNo=${o.oNo}|}"
	           class="order-card"
	           th:classappend="(selectedOrder?.oNo == o.oNo) or (selectedOrder==null and iter.index==0) ? ' active'">
	          <div class="order-card-title">
	            <span>주문 #<span th:text="${o.oNo}"></span></span>
	            <span th:text="${o.payment}"></span>
	          </div>
	          <div class="order-card-detail">
	            <div th:text="${#dates.format(o.regDate,'yyyy-MM-dd HH:mm')}"></div>
	            <div th:text="${o.oAddress}"></div>
	          </div>
	        </a>
	      </div>
	    </div>
	    
	    <!-- 우측 상세 패널 -->
	    <div class="order-detail-panel">

	      <th:block th:if="${selectedOrder!=null}">
	        <h4>주문번호 <span th:text="${selectedOrder.oNo}"></span></h4>

	        <!-- 타임라인 -->
	        <ul class="status-steps">
	        	<li th:classappend="${#lists.contains({'ACCEPTED', 'DISPATCHED', 'DELIVERING', 'COMPLETED'}, selectedOrder.status)} ? 'completed'">
    				<span>조리 중</span>
					  </li>
					  <li th:classappend="${#lists.contains({'DISPATCHED', 'DELIVERING', 'COMPLETED'}, selectedOrder.status)} ? 'completed'">
					    <span>배차 완료</span>
					  </li>
					  <li th:classappend="${#lists.contains({'DELIVERING', 'COMPLETED'}, selectedOrder.status)} ? 'completed'">
					    <span>배달 중</span>
					  </li>
					  <li th:classappend="${selectedOrder.status=='COMPLETED'} ? 'completed'">
					    <span>완료</span>
					  </li>
					</ul>

	        <!-- 주문 정보 카드 -->
			<div class="card order-info-card mb-4">
			  <div class="card-header bg-white border-0 px-0 pb-0">
			    <h5 class="mb-0"><i class="bi bi-receipt me-2 text-primary"></i>주문 정보</h5>
			  </div>
			  <ul class="list-group list-group-flush mt-2">
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="bi bi-clock-history text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">주문일시</div>
			      <div class="fw-bold" th:text="${#dates.format(selectedOrder.regDate,'yyyy-MM-dd HH:mm')}">2025-08-06 12:34</div>
			    </li>
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="bi bi-truck text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">배달/픽업</div>
			      <div class="fw-bold" th:text="${selectedOrder.oAddress!=null?'배달':'픽업'}">배달</div>
			    </li>
			    <li class="list-group-item d-flex align-items-center py-2" th:if="${selectedOrder.oAddress}">
			      <i class="bi bi-geo-alt text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">주소</div>
			      <div class="text-end" th:text="${selectedOrder.oAddress}">서울 강남구 …</div>
			    </li>
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="bi bi-currency-won text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">총액/수량</div>
			      <div class="fw-bold">
			        <span th:text="${selectedOrder.totalPrice + '원'}">11,000원</span> /
			        <span th:text="${selectedOrder.quantity + '개'}">1개</span>
			      </div>
			    </li>
			    <li class="list-group-item py-2">
			      <i class="bi bi-list-ul text-secondary me-3 fs-5"></i>
			      <div class="d-flex w-100">
			        <div class="flex-grow-1">메뉴</div>
			        <div class="fw-bold text-end" th:utext="${selectedOrder.menus}">치킨 *1</div>
			      </div>
			    </li>
			    <li class="list-group-item d-flex align-items-center py-2">
			      <i class="bi bi-chat-square-text text-secondary me-3 fs-5"></i>
			      <div class="flex-grow-1">요청사항</div>
			      <div class="fw-bold" th:text="${selectedOrder.request ?: '없음'}">없음</div>
			    </li>
			  </ul>
			</div>

			<!-- 상태 변경 버튼 -->
			<div class="btn-group">
					  <button th:if="${selectedOrder.status=='ACCEPTED' or selectedOrder.status=='DISPATCHED'}"
					          class="btn btn-warning me-2" type="button"
					          th:onclick="|location.href='@{/shop/orderManage/{oNo}/status(oNo=${selectedOrder.oNo},newStatus='DELIVERING')}'|">
					    🚚 배달 시작
					  </button>
				  </div>

			  <button th:if="${selectedOrder.status=='DELIVERING'}"
			          class="btn btn-success me-2"
			          type="button"
			          th:onclick="|location.href='@{/shop/orderManage/{oNo}/status(oNo=${selectedOrder.oNo},newStatus=COMPLETED)}'|">
			    ✅ 배달 완료
			  </button>
			</div>
	      </th:block>

	      <th:block th:if="${selectedOrder==null}">
	        <div class="text-center text-muted p-5">
	          왼쪽에서 주문을 선택하세요.
	        </div>
	      </th:block>
	    </div>
		</div>
	  </div>
	</th:block>
</body>
</html>

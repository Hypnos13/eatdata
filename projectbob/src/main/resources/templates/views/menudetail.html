<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/main_layout}">
<head>
<meta charset="UTF-8">
<title>Î©îÏù∏ ÌéòÏù¥ÏßÄ</title>

<!-- Bootstrap CSS -->
<link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">

<!-- ÏÇ¨Ïö©Ïûê Ï†ïÏùò CSS -->
<link rel="stylesheet" href="/css/main.css">

<!-- Bootstrap Bundle JS -->
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div layout:fragment="content">

        <div class="container mt-4">
            <div class="row">
                <!-- ÏôºÏ™Ω: Î©îÎâ¥ ÏòÅÏó≠ -->
                <div class="col-md-8">

                    <div class="d-flex align-items-center mb-3">
                        <img src="https://i.imgur.com/6p4jYkF.png" alt="Îß•ÎèÑÎÇ†Îìú" width="50" />
                        <div class="ms-3">
                            <h5 class="mb-0">[[ ${shop.name} ]] - [[ ${shop.address1} ]]</h5>
                            <small>‚òÖ [[${shop.rating}]] / ÏµúÏÜåÏ£ºÎ¨∏Í∏àÏï°
                                [[${#numbers.formatInteger(shop.minPrice,0,'COMMA')}]]Ïõê / Í∞ÄÍ≤å Ï∞ú
                                [[${shop.heart}]]</small>
                        </div>
                    </div>

                    <!-- ÌÉ≠ Î©îÎâ¥ -->
                    <ul class="nav nav-tabs w-100 justify-content-between">
                        <li class="nav-item flex-fill text-center"><a
                            class="nav-link active" data-bs-toggle="tab" href="#menu">Î©îÎâ¥</a>
                        </li>
                        <li class="nav-item flex-fill text-center"><a
                            class="nav-link" data-bs-toggle="tab" href="#review">ÌÅ¥Î¶∞Î¶¨Î∑∞</a></li>
                        <li class="nav-item flex-fill text-center"><a
                            class="nav-link" data-bs-toggle="tab" href="#info">Ï†ïÎ≥¥</a></li>
                    </ul>

                    <div class="tab-content mt-3">
                        <!-- Î©îÎâ¥ ÌÉ≠ -->
                        <div class="tab-pane fade show active" id="menu">
                            <div class="row">

                                <!-- Î©îÎâ¥ Ïπ¥Îìú  -->
                                <th:block th:if="${not #lists.isEmpty(menuList)}">
                                    <div class="col-md-6 mb-4" th:each="menu, status: ${menuList}">
                                        <div class="card text-center p-3 menu-card"
                                            th:attr="
                                            data-id=${menu.mId},
                                            data-name=${menu.name},
                                            data-price=${menu.price},
                                            data-shop-id=${menu.sId},
                                            data-image=${menu.mPictureUrl},
                                            data-info=${menu.mInfo}">

                                            <div
                                                class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="menu-title">[[ ${menu.name} ]]</span>
                                            </div>

                                            <img th:src="${menu.mPictureUrl}" alt="Î©îÎâ¥ ÏÇ¨ÏßÑ"
                                                class="img-fluid mb-2" />

                                            <div class="fw-semibold">[[ ${menu.mInfo} ]]</div>

                                            <div class="menu-price">[[
                                                ${#numbers.formatInteger(menu.price, 0, 'COMMA')} ]]Ïõê</div>
                                        </div>
                                    </div>
                                </th:block>

                                <th:block th:unless="${not #lists.isEmpty(menuList)}">
                                    <div class="alert alert-info text-center">Îì±Î°ùÎêú Î©îÎâ¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
                                </th:block>

                            </div>
                        </div>

                        <!-- Î¶¨Î∑∞ ÌÉ≠ -->
                        <div class="tab-pane fade" id="review">
                            <!-- Î¶¨Î∑∞ ÌÉ≠ ÏÉÅÎã® -->
                            <div class="border rounded p-3 mb-3 bg-white">
                                <div
                                    class="d-flex align-items-center mb-2 justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <span class="fs-4 text-warning me-2"> <i
                                            class="bi bi-star-fill"></i>
                                        </span> <span class="fs-5">Î≥ÑÏ†ê&nbsp; </span>
                                        <h2 class="fw-bold me-3"
                                            th:text="${#numbers.formatDecimal(reviewAvg, 1, 1)}">4.9</h2>

                                    </div>
                                    <!-- Ï∞úÎ≤ÑÌäº -->
                                    <div class="d-flex align-items-center">
                                        <span>Í∞ÄÍ≤å Ï∞úÌïòÍ∏∞</span>
                                        <button type="button" id="btnHeart"
                                            class="btn btn-outline-danger btn-sm px-2 py-0"
                                            th:data-sid="${shop.sId}">
                                            <span class="me-1" id="heartCount" th:text="${shop.heart}">0</span>
                                            <i class="bi bi-heart-fill"></i>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    Î¶¨Î∑∞ <span th:text="${reviewList.size()}">0</span>Í∞ú
                                </div>
                            </div>
                            <!-- ÎåìÍ∏ÄÏì∞Í∏∞ -->
                            <div class="row my-3">
                                <div class="col border p-1 text-center">
                                    <span id="reviewWrite" class="text-success"
                                        style="cursor: pointer;"> <i
                                        class="bi bi-file-earmark-text-fill"
                                        style="color: cornflowerblue;"></i>Î¶¨Î∑∞Ïì∞Í∏∞
                                    </span>
                                </div>
                            </div>
                            <!-- ÎåìÍ∏Ä Ìó§Îçî ÏòÅÏó≠ -->
                            <!-- ÎåìÍ∏Ä Ïì∞Í∏∞ Ìèº -->
                            <div class="row my-3 d-none" id="reviewForm">
                                <div class="col">
                                    <form name="reviewWriteForm" id="reviewWriteForm"
                                        enctype="multipart/form-data">
                                        <input type="hidden" name="sId" th:value="${shop.sId}">
                                        <!-- 	<input type="hidden" name="id" th:value="${member.id}"> -->
                                        <div class="row bg-light my-3 p-3 border">
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col text-center">

                                                        <!-- Î≥ÑÏ†ê ÏòÅÏó≠ -->
                                                        <div class="mb-2">
                                                            <label class="form-label">Î≥ÑÏ†ê</label>
                                                            <div id="starRating" class="star-rating">
                                                                <input type="radio" name="rating" id="star5" value="5"><label
                                                                    for="star5">&#9733;</label> <input type="radio"
                                                                    name="rating" id="star4" value="4"><label
                                                                    for="star4">&#9733;</label> <input type="radio"
                                                                    name="rating" id="star3" value="3"><label
                                                                    for="star3">&#9733;</label> <input type="radio"
                                                                    name="rating" id="star2" value="2"><label
                                                                    for="star2">&#9733;</label> <input type="radio"
                                                                    name="rating" id="star1" value="1"><label
                                                                    for="star1">&#9733;</label>
                                                            </div>
                                                        </div>
                                                        <!-- ÏÇ¨ÏßÑ -->
                                                        <div class="mb-2">
                                                            <label for="rPicture" class="form-label">ÏÇ¨ÏßÑ Ï≤®Î∂Ä</label> <input
                                                                type="file" name="rPicture" id="rPicture"
                                                                accept="image/*" class="form-control">
                                                            <!-- Ïç∏ÎÑ§Ïùº -->
                                                            <img id="imgPreview"
                                                                style="display: none; max-width: 100px; margin-top: 8px;">
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="row my-3">
                                                    <div class="col-md-10">
                                                        <textarea name="reviewContent" id="reviewContent"
                                                            class="form-control" rows="4"></textarea>
                                                    </div>
                                                    <div class="col-md">
                                                        <input type="submit" value="ÎåìÍ∏ÄÏì∞Í∏∞"
                                                            class="btn btn-success h-100 w-100"
                                                            id="reviewWriteButton">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Î¶¨Î∑∞ Î¶¨Ïä§Ìä∏ -->
                            <div th:if="${not #lists.isEmpty(reviewList)}">
                                <div th:each="review : ${reviewList}"
                                    class="border-bottom pb-3 mb-3">
                                    <div class="d-flex align-items-center mb-1">
                                        <span class="fw-bold"
                                            th:text="${#strings.substring(review.id,0,2) + '**Îãò'}">ad**Îãò</span>
                                        <span class="text-muted small ms-2"
                                            th:text="${#dates.format(review.regDate, 'yyyy-MM-dd')}">ÎÇ†Ïßú</span>
                                        <div class="ms-auto">
                                            <button class="modifyReview btn btn-outline-success btn-sm"
                                                th:data-no="${review.rNo}">
                                                <i class="bi bi-journal-text">ÏàòÏ†ï</i>
                                            </button>
                                            <button class="deleteReview btn btn-outline-warning btn-sm"
                                                th:data-no="${review.rNo}">
                                                <i class="bi bi-trash">ÏÇ≠Ï†ú</i>
                                            </button>
                                            <button class="btn btn-outline-danger btn-sm"
                                                th:onclick="reportReview('${review.rNo}')">
                                                <i class="bi bi-telephone-outbound">Ïã†Í≥†</i>
                                            </button>
                                        </div>
                                        <!-- <span class="ms-auto text-danger small" style="cursor:pointer">Ïã†Í≥†</span> -->
                                    </div>
                                    <!-- Î≥ÑÏ†ê  -->
                                    <div class="mb-1">
                                        <span class="me-2 text-warning"> <i
                                            class="bi bi-star-fill"></i>
                                        </span> <span th:text=" ' ' + ${review.rating} +'Ï†ê'"
                                            class="fw-bold ms-1"></span>
                                    </div>
                                    <!-- Î¶¨Î∑∞ ÏÇ¨ÏßÑ  -->
                                    <div th:if="${review.rPicture != null}">
                                        <img th:src="@{'/images/review/' + ${review.rPicture}}"
                                            alt="Î¶¨Î∑∞ÏÇ¨ÏßÑ" style="max-width: 200px;"
                                            class="rounded shadow-sm mb-2" />
                                    </div>
                                    <!-- Î©îÎâ¥ ÏÑ§Î™Ö -->
                                    <div class="text-secondary small mb-1">
                                        <span th:text="${review.menuName}">ÏãπÏãπÍπÄÏπò</span>
                                    </div>
                                    <!-- Î¶¨Î∑∞ ÎÇ¥Ïö© -->
                                    <div th:text="${review.content}">good day</div>
                                </div>
                            </div>
                            <!-- Î¶¨Î∑∞ ÏóÜÏùÑÎïå -->
                            <div th:unless="${not #lists.isEmpty(reviewList)}"
                                class="text-center text-muted p-5">no Î¶¨Î∑∞~</div>

                        </div>

                        <!-- Ï†ïÎ≥¥ ÌÉ≠ -->
                        <div class="tab-pane fade" id="info">
                            <p>
                                <strong>ÏòÅÏóÖÏãúÍ∞Ñ:</strong>[[${shop.opTime}]]<br /> <strong>ÏúÑÏπò:</strong>
                                <span id="storeAddress">[[${shop.address1}]] -
                                    [[${shop.address2}]]</span><br /> <strong>Ï†ÑÌôî:</strong>
                                [[${shop.phone}]]
                            </p>

                            <div class="mt-3">
                                <h6>üìç ÏúÑÏπò ÏßÄÎèÑ</h6>
                                <div id="map"
                                    style="width: 100%; height: 300px; border: 1px solid #ccc; border-radius: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="card order-summary p-3">
                        <h5 class="card-title mb-3">Ï£ºÎ¨∏Ìëú</h5>

                        <div class="order-item-list mb-3">
                            <!-- Ïû•Î∞îÍµ¨Îãà ÎπÑÏñ¥ÏûàÏùÑ Îïå Î©îÏãúÏßÄ -->
                            <div id="emptyOrderMessage"
                                class="text-muted fst-italic small text-center"
                                th:classappend="${#lists.isEmpty(cartList)} ? '' : 'd-none'">
                                Ï£ºÎ¨∏Ìïú Î©îÎâ¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>

                            <!-- Î©îÏù∏Î©îÎâ¥ Î∞òÎ≥µ (ca_pidÍ∞Ä nullÏù∏ Ìï≠Î™©Îßå) -->
                            <!-- Í∞Å Î©îÏù∏ Î©îÎâ¥ Ìï≠Î™©Ïóê Í≥†Ïú†Ìïú data-ca-id ÏÜçÏÑ±ÏùÑ Ï∂îÍ∞ÄÌïòÏó¨ JSÏóêÏÑú Ï∞∏Ï°∞Ìï† Ïàò ÏûàÎèÑÎ°ù Ìï©ÎãàÎã§. -->
                            <div th:each="mainItem : ${cartList}"
                                th:if="${mainItem.caPid == null}"
                                th:data-ca-id="${mainItem.caId}"
                                class="pb-3 mb-3 border-bottom cart-main-item">

                                <div class="mb-2">
                                    <!-- Î©îÏù∏ Î©îÎâ¥ Ïù¥Î¶Ñ Î∞è Í∞ÄÍ≤© -->
                                    <div class="fw-bold small mb-1"
                                        th:text="|${mainItem.menuName} : ${#numbers.formatInteger(mainItem.menuPrice, 0, 'COMMA')} Ïõê|">
                                        Î©îÏù∏Î©îÎâ¥Î™Ö : 0Ïõê</div>

                                    <!-- ÏòµÏÖò Î∞òÎ≥µ Ï∂úÎ†• -->
                                    <!-- ÌòÑÏû¨ mainItemÏùò caIdÎ•º Î∂ÄÎ™® ca_idÎ°ú Í∞ÄÏßÄÎäî ÏòµÏÖòÎßå Ï∂úÎ†•Ìï©ÎãàÎã§. -->
                                    <div th:each="optItem : ${cartList}"
                                        th:if="${optItem.caPid != null and optItem.caPid == mainItem.caId}"
                                        th:data-ca-id="${optItem.caId}"
                                        class="text-muted small ms-3 mb-1 cart-option-item"
                                        th:text="|‚îî ÏòµÏÖò: ${optItem.optionName} (${#numbers.formatInteger(optItem.optionPrice, 0, 'COMMA')}Ïõê)|">
                                        ‚îî ÏòµÏÖò: ÏòµÏÖòÎ™Ö (0Ïõê)</div>

                                    <!-- Ï¥ù Í∞ÄÍ≤© (Ìï¥Îãπ Î©îÏù∏ Î©îÎâ¥ + ÏòµÏÖòÎì§Ïùò Ìï©Í≥Ñ) -->
                                    <!-- Ïù¥ totalPriceÎäî ÌòÑÏû¨ mainItemÏùò totalPriceÎ•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.
                                         Ïª®Ìä∏Î°§Îü¨ÏóêÏÑú Ïù¥ Í∞íÏùÑ Ï†ïÌôïÌûà Í≥ÑÏÇ∞ÌïòÏó¨ ÎÑòÍ≤®Ï§òÏïº Ìï©ÎãàÎã§.
                                         ÌòÑÏû¨Îäî Í∞Å Ïπ¥Ìä∏ Ìï≠Î™©Ïùò total_priceÍ∞Ä Ìï¥Îãπ Ìï≠Î™©ÎßåÏùò Í∞ÄÍ≤©Ïù¥ÎØÄÎ°ú,
                                         Ïó¨Í∏∞ÏÑúÎäî mainItem.totalPriceÎ•º ÌëúÏãúÌïòÍ≥†,
                                         Ï†ÑÏ≤¥ Ïû•Î∞îÍµ¨ÎãàÏùò Ï¥ù Í∞ÄÍ≤©ÏùÄ ÏïÑÎûò 'Ï¥ù Í≤∞Ï†ú Í∏àÏï°'ÏóêÏÑú ÌëúÏãúÌïòÎäî Í≤ÉÏù¥ ÏùºÎ∞òÏ†ÅÏûÖÎãàÎã§. -->
                                    <div>
                                        Ìï≠Î™© Ï¥ù Í∏àÏï°: <span
                                            th:text="${#numbers.formatInteger(mainItem.itemGroupTotalPrice, 0, 'COMMA')} + 'Ïõê'" >0Ïõê</span>
                                    </div>


                                    <!-- ÏàòÎüâ Ï°∞Ï†à Î∞è ÏÇ≠Ï†ú Î≤ÑÌäº -->
                                    <div
                                        class="d-flex justify-content-between align-items-center mt-2">
                                        <div class="d-flex align-items-center">
                                            <button class="btn btn-outline-secondary btn-sm py-0 px-1 btn-quantity-minus"
                                                th:data-ca-id="${mainItem.caId}"
                                                style="font-size: 0.75rem;">‚àí</button>
                                            <input type="text"
                                                class="form-control form-control-sm mx-1 text-center quantity-input"
                                                th:value="${mainItem.quantity}" readonly
                                                th:data-ca-id="${mainItem.caId}"
                                                style="width: 32px; height: 26px; font-size: 0.75rem; padding: 0;">
                                            <button class="btn btn-outline-secondary btn-sm py-0 px-1 btn-quantity-plus"
                                                th:data-ca-id="${mainItem.caId}"
                                                style="font-size: 0.75rem;">+</button>
                                        </div>
                                        <button class="btn btn-outline-danger btn-sm py-0 px-2 btn-delete-main-item"
                                            th:data-ca-id="${mainItem.caId}"
                                            style="font-size: 0.75rem;">x</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ï†ÑÏ≤¥ Ïû•Î∞îÍµ¨Îãà Ï¥ù Í≤∞Ï†ú Í∏àÏï° ÌëúÏãú -->
                        <div id="totalOrderPrice" class="mb-2 fw-bold"
                            th:if="${not #lists.isEmpty(cartList)}">
                            Ï¥ù Í≤∞Ï†ú Í∏àÏï°: <span th:text="${#numbers.formatInteger(totalPrice, 0, 'COMMA')} + 'Ïõê'">0Ïõê</span>
                        </div>

                        <!-- Î∞∞Îã¨ÎπÑ Î©òÌä∏Îßå ÎÇ®ÍπÄ -->
                        <div id="orderSummaryInfo" class="mb-3"
                            th:classappend="${#lists.isEmpty(cartList)} ? 'd-none' : ''">
                            <small class="text-muted d-block mt-1"> (Î∞∞Îã¨ÎπÑ 3,000Ïõê Ìè¨Ìï®) </small>
                        </div>

                        <!-- Î≤ÑÌäº -->
                        <button class="btn btn-danger w-100 btn-sm mb-2"
                            id="btnRemoveAllItems">Ï£ºÎ¨∏ Ï†ÑÏ≤¥ Ï∑®ÏÜå</button> <!-- ID Î≥ÄÍ≤Ω -->
                        <button class="btn btn-sm w-100 text-white" id="btnOrderNow"
                            style="background-color: #43d091;">Ï£ºÎ¨∏ÌïòÍ∏∞</button>

                        <!-- ÎπÑÌöåÏõêÏö© guest ID -->
                        <div id="guestInfo" th:data-guest-id="${session.guestId}"></div>
                    </div>
                </div>

            </div>
        </div>

        <form id="orderForm" method="post" action="/pay" style="display: none">
            <input type="hidden" name="menuId" id="orderMenuId">
            <input type="hidden" name="count" id="orderCount">
            <input type="hidden" name="optionIds" id="orderOptionIds">
            <input type="hidden" name="totalPrice" id="orderTotalPrice">
        </form>

    </div>

    <script src="/js/main.js"></script>
</body>
</html>

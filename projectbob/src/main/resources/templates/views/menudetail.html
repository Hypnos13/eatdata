<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/main_layout}">
<head>
<meta charset="UTF-8">
<title>Î©îÏù∏ ÌéòÏù¥ÏßÄ</title>

<!-- Bootstrap CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- ÏÇ¨Ïö©Ïûê Ï†ïÏùò CSS -->
<link rel="stylesheet" href="/css/main.css">

<!-- Bootstrap Bundle JS -->
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
	<div layout:fragment="content">

		<div class="container mt-4">
			<div class="row" id="global-content">
				<!-- ÏôºÏ™Ω: Î©îÎâ¥ ÏòÅÏó≠ -->
				<div class="col-md-8">
				
					<div class="d-flex align-items-center mb-3">
						<img src="https://i.imgur.com/6p4jYkF.png" alt="Îß•ÎèÑÎÇ†Îìú" width="50" />
						<div class="ms-3">
							<h5 class="mb-0">[[ ${shop.name} ]] - [[ ${shop.address1} ]]</h5>
							<small>‚òÖ [[${#numbers.formatDecimal(reviewAvg, 1, 1)}]] / ÏµúÏÜåÏ£ºÎ¨∏Í∏àÏï° [[${#numbers.formatInteger(shop.minPrice,0,'COMMA')}]]Ïõê</small>
						</div>
						
						<!-- Ï∞úÎ≤ÑÌäº -->
							<div class="ms-auto">									
								<button type="button" id="btnLikeList" th:data-sid="${shop.sId}" 
								class="btn btn-outline-secondary" 
								th:classappend="${liked} ? ' btn-secondary liked' : ' btn-outline-secondary'">
								<i class="bi bi-heart-fill me-1"></i>
								<span id="likeText" th:text="${liked} ? 'Ï∞ú' : 'Ï∞ú ÌïòÍ∏∞'">()Ï∞ú</span>			
								(<span id="likeCount" th:text="${heartCount}">0</span>)						
								</button>
							</div>
						
					</div>

					<!-- ÌÉ≠ Î©îÎâ¥ -->
					<ul class="nav nav-tabs w-100 justify-content-between">
						<li class="nav-item flex-fill text-center"><a
							class="nav-link active" data-bs-toggle="tab" href="#menu">Î©îÎâ¥</a>
						</li>
						<li class="nav-item flex-fill text-center"><a
							class="nav-link" data-bs-toggle="tab" href="#review">ÌÅ¥Î¶∞Î¶¨Î∑∞</a></li>
						<li class="nav-item flex-fill text-center"><a
							class="nav-link" data-bs-toggle="tab" href="#info">Ï†ïÎ≥¥</a></li>
					</ul>

					<div class="tab-content mt-3">
						<!-- Î©îÎâ¥ ÌÉ≠ -->
						<div class="tab-pane fade show active" id="menu">
							<div class="row">						
					
							<!-- Î©îÎâ¥ Ïπ¥Îìú  -->
					<th:block th:if="${not #lists.isEmpty(menuList)}">
					<div class="col-md-6 mb-4" th:each="menu, status: ${menuList}">
									<div class="card text-center p-3 menu-card" 
											th:attr="data-id=${menu.mId},data-name=${menu.name},data-price=${menu.price}">
										<div class="d-flex justify-content-between align-items-center mb-2">
											<span class="menu-title">[[ ${menu.name} ]]</span>
										</div>
										<img src="https://i.imgur.com/Sg4b61a.png" alt="Î©îÎâ¥ ÏÇ¨ÏßÑ"
											class="img-fluid mb-2" />
										<div class="fw-semibold">[[ ${menu.mInfo} ]]</div>
										<div class="menu-price">[[ ${#numbers.formatInteger(menu.price, 0, 'COMMA')} ]]Ïõê</div>
									</div>
								</div>
					</th:block>
					
					<th:block th:unless="${not #lists.isEmpty(menuList)}">
						<div class="alert alert-info text-center">Îì±Î°ùÎêú Î©îÎâ¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
					</th:block>
				
			
								
							</div>
						</div>

						<!-- Î¶¨Î∑∞ ÌÉ≠ -->
						<div class="tab-pane fade" id="review">
						<!-- Î¶¨Î∑∞ ÌÉ≠ ÏÉÅÎã® -->
						<div class="border rounded p-3 mb-3 bg-white">
							<div class="d-flex align-items-center mb-2 justify-content-between" >
								<div class="d-flex align-items-center">
									<span class="fs-4 text-warning me-2">
										<i class="bi bi-star-fill"></i>
									</span>								
											<span class="fs-5">Î≥ÑÏ†ê&nbsp; </span>	
								<h2 class="fw-bold me-3" th:text="${#numbers.formatDecimal(reviewAvg, 1, 1)}">4.9</h2>
													
							</div>
							<!-- ÌïòÌä∏Î≤ÑÌäº -->
							<!-- <div class="d-flex align-items-center">						
							<span>Í∞ÄÍ≤å Ï¢ãÏïÑÏöî</span>		
								<button type="button" id="btnHeart" class="btn btn-outline-danger btn-sm px-2 py-0"
														th:data-sid="${shop.sId}">
								<span class="me-1" id="heartCount" th:text="${shop.heart}">0</span>
									<i class="bi bi-heart-fill"></i>
								</button>
							</div> -->
							</div>
							<div>
								Î¶¨Î∑∞ <span th:text="${reviewList.size()}">0</span>Í∞ú
							</div>
						</div>
						<!-- ÎåìÍ∏ÄÏì∞Í∏∞ -->
						<div class="row my-3">
						<div class="col border p-1 text-center">
						<span id="reviewWrite" class="text-success" style="cursor: pointer;">
							<i class="bi bi-file-earmark-text-fill" style="color: cornflowerblue;"></i>Î¶¨Î∑∞Ïì∞Í∏∞
						</span>
						</div>
						</div>
						<!-- ÎåìÍ∏Ä Ìó§Îçî ÏòÅÏó≠ -->						
			<div id="reviewFormOriginalContainer">
						<!-- ÎåìÍ∏Ä Ïì∞Í∏∞ Ìèº -->
					<div class="row my-3 d-none" id="reviewForm" th:if="${member != null}">
						<div class="col">
							<form name="reviewWriteForm" id="reviewWriteForm" enctype="multipart/form-data">
								<input type="hidden" name="sId" th:value="${shop.sId}">
						  	<input type="hidden" name="id" th:value="${member?.id}">
						  	<input type="hidden" id="loginId" th:value="${member != null ? member.id : ''}">
						  	<input type="hidden" id="reviewFormMode" value="ÎåìÍ∏ÄÏì∞Í∏∞">
						  	<input type="hidden" id="shopOwnerId" th:value="${shop.id}">
						  	<!-- <input type="hidden" name="mId" th:value="${menu.mId}"> -->			
								<div class="row bg-light my-3 p-3 border">
									<div class="col">
										<div class="row">
											<div class="col text-center">
											
											<!-- Î©îÎâ¥ ÏÑ†ÌÉù -->
						<div class="mb-2">
							<label class="form-label">Î©îÎâ¥ ÏÑ†ÌÉù</label>
							<select name="mId" class="form-select" required>
								<option value="">Î©îÎâ¥Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
								<option th:each="menu : ${menuList}" th:value="${menu.mId}" th:text="${menu.name}"></option>
							</select>
						</div>
											<!-- Î≥ÑÏ†ê ÏòÅÏó≠ -->
						<div class="mb-2">
							<label class="form-label">Î≥ÑÏ†ê</label>
							<div id="starRating" class="star-rating">
								<input type="radio" name="rating" id="star5" value="5"><label for="star5">&#9733;</label>
								<input type="radio" name="rating" id="star4" value="4"><label for="star4">&#9733;</label>
								<input type="radio" name="rating" id="star3" value="3"><label for="star3">&#9733;</label>
								<input type="radio" name="rating" id="star2" value="2"><label for="star2">&#9733;</label>
								<input type="radio" name="rating" id="star1" value="1"><label for="star1">&#9733;</label>
							</div>
						</div>
						<!-- ÏÇ¨ÏßÑ -->
						<div class="mb-2">
							<label for="rPicture" class="form-label">ÏÇ¨ÏßÑ Ï≤®Î∂Ä</label>
							<input type="file" name="reviewUploadFile" id="rPicture" accept="image*" class="form-control">
							<!-- Ïç∏ÎÑ§Ïùº -->
							<img id="imgPreview" style="display:none; max-width:100px; margin-top:8px;">
						</div>
												
											</div>
										</div>
										<div class="row my-3">
											<div class="col-md-10">
												<textarea name="content" id="reviewContent" class="form-control" rows="4"></textarea>												
											</div>
											<div class="col-md">
												<input type="submit" value="ÎåìÍ∏ÄÏì∞Í∏∞" class="btn btn-success h-100 w-100" id="reviewSubmitButton">
											</div>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
		</div>
		
						<!-- Î¶¨Î∑∞ Î¶¨Ïä§Ìä∏ -->
						<!-- <div id="reviewList" th:if="${not #lists.isEmpty(reviewList)}"> -->
						<div id="reviewList">
							<div th:each="review : ${reviewList}" class="reviewRow border-bottom pb-3 mb-3">
								<div class="d-flex align-items-center mb-1">
									<span class="fw-bold" th:text="${#strings.substring(review.id,0,2) + '**Îãò'}">ad**Îãò</span>
									<span class="text-muted small ms-2" th:text="${#dates.format(review.regDate, 'yyyy-MM-dd')}">ÎÇ†Ïßú</span>
									<div class="ms-auto">
									<button th:if="${member != null and review.id == member.id}" class="modifyReview btn btn-outline-success btn-sm" th:data-no="${review.rNo}">
										<i class="bi bi-journal-text">ÏàòÏ†ï</i>									
									</button>
									<button th:if="${member != null and review.id == member.id }" class="deleteReview btn btn-outline-dark btn-sm" th:data-no="${review.rNo}" th:data-sid="${review.sId}">
										<i class="bi bi-trash">ÏÇ≠Ï†ú</i>
									</button>
									<button th:unless="${member != null and review.id == member.id}" class="btn btn-outline-danger btn-sm" th:onclick="reportReview('${review.rNo}')">
										<i class="bi bi-telephone-outbound">Ïã†Í≥†</i>
									</button>
									</div>
									<!-- <span class="ms-auto text-danger small" style="cursor:pointer">Ïã†Í≥†</span> -->
								</div>
								<!-- Î≥ÑÏ†ê  -->
								<div class="mb-1">
									<span class="me-2 text-warning">
										<i class="bi bi-star-fill"></i>										
									</span>
									<span th:text=" ' ' + ${review.rating} +'Ï†ê'" class="fw-bold ms-1"></span>
								</div>
								<!-- Î¶¨Î∑∞ ÏÇ¨ÏßÑ  -->
								<div th:if="${review.rPicture != null}">
									<img th:src="@{'/images/review/' + ${review.rPicture} + '?t=' + ${now}}" alt="Î¶¨Î∑∞ÏÇ¨ÏßÑ" 
													style="max-width:200px;" class="rounded shadow-sm mb-2" />
								</div>
								<!-- Î©îÎâ¥ ÏÑ§Î™Ö -->
								<div class="text-secondary small mb-1">
									<span th:text="${review.menuName}">ÏãπÏãπÍπÄÏπò</span>
								</div>
								<!-- Î¶¨Î∑∞ ÎÇ¥Ïö© -->
								<div class = "review-content" th:text="${review.content}">good day</div>
								<!-- ÎåÄÎåìÍ∏Ä(ÏÇ¨Ïû•Îãò Ï†ÑÏö©) -->
								<div th:if="${reviewReplyMap[review.rNo] != null}" class="mt-3">
									<div class="card p-2 bg-light border-info" style="border-left:4px solid #3498db;">
										<div class="d-flex align-items-center mb-1">
											<span class="fw-bold text-primary">
												<i class="bi bi-person-badge"></i>ÏÇ¨Ïû•Îãò
											</span>
											<span class="text-muted small ms-2" th:text="${#dates.format(reviewReplyMap[review.rNo].regDate, 'yyyy-MM-dd HH:mm')}">ÎÇ†Ïßú</span>
											<div class="ms-auto" th:if="${member != null and member.id == shop.id}">
												<button type="button" class="btn btn-outline-primary btn-sm px-3 modifyReviewReply"
																	th:data-rrno="${reviewReplyMap[review.rNo].rrNo}" th:data-rno="${review.rNo}"
																	th:data-content="${reviewReplyMap[review.rNo].content}">ÏàòÏ†ï</button>
												<button type="button" class="btn btn-outline-danger btn-sm px-3 deleteReviewReply"
																	th:data-rrno="${reviewReplyMap[review.rNo].rrNo}" th:data-rno="${review.rNo}" th:data-sid="${shop.sId}">ÏÇ≠Ï†ú</button>
											</div>										
										</div>
										<div th:text="${reviewReplyMap[review.rNo].content}" class="ms-3"></div>
									</div>
								</div>
								<div th:if="${member != null and member.id == shop.id and reviewReplyMap[review.rNo] == null}" class="mt-2 text-end">
									<button type="button" class="btn btn-outline-primary btn-sm px-2 py-0 review-reply-btn" th:data-review-no="${review.rNo}">
										<i class="bi bi-person-badge"></i>ÏÇ¨Ïû•Îãò ÎåìÍ∏ÄÏì∞Í∏∞
									</button>
								</div>
								<!-- ÏÇ¨Ïû•Îãò ÎåìÍ∏ÄÏì∞Í∏∞ Ìèº -->
								<div class="reviewReplyForm d-none p-3 rounded shadow-sm" style="background:#f8fafc;">
									<form class="review-reply-form">
										<input type="hidden" name="rNo" th:value="${review.rNo}">
										<input type="hidden" name="sId" th:value="${shop.sId}">
										<input type="hidden" name="rrNo" th:value="${reviewReplyMap[review.rNo].rrNo}" th:if="${reviewReplyMap[review.rNo] != null}">
										<div class="mb-2">
											<textarea name="content" class="form-control fs-5 py-3" rows="3" maxlength="250"
													placeholder="ÏÇ¨Ïû•Îãò ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" style="resize: none;"></textarea>																				
										</div>
										<div class="text-end">
											<th:block th:if="${member != null and member.id == shop.id}">
												<button class="btn btn-success px-4 me-1 review-reply-submit-btn" type="submit">Îì±Î°ù</button>
												<button type="button" class="btn btn-outline-primary px-4 me-1 modifyReviewReply">ÏàòÏ†ï</button>
												<button type="button" class="btn btn-outline-danger px-4 deleteReviewReply" th:attr="data-rrno=${reviewReplyMap[review.rNo].rrNo}" th:if="${reviewReplyMap[review.rNo] != null}" th:data-sid="${shop.sId}">ÏÇ≠Ï†ú</button>
											</th:block>
										</div>
									</form>
								</div>
							</div><!-- Î¶¨Î∑∞Î¶¨Ïä§Ìä∏ ÎÅù -->
						</div>
						<!-- Î¶¨Î∑∞ ÏóÜÏùÑÎïå -->
						<!-- <div th:unless="${not #lists.isEmpty(reviewList)}" class="text-center text-muted p-5"> -->
						<div id="noReview" th:style="${not #lists.isEmpty(reviewList)} ? 'display:none;' : 'display:block;'" 
									class="text-center text-muted p-5">
							no Î¶¨Î∑∞~
						</div>									
					
						</div>

						<!-- Ï†ïÎ≥¥ ÌÉ≠ -->
						<div class="tab-pane fade" id="info">
							<p>
								<strong>ÏòÅÏóÖÏãúÍ∞Ñ:</strong>[[${shop.opTime}]]<br /> <strong>ÏúÑÏπò:</strong> <span
									id="storeAddress">[[${shop.address1}]] - [[${shop.address2}]]</span><br /> <strong>Ï†ÑÌôî:</strong>
								[[${shop.phone}]]
							</p>

							<div class="mt-3">
								<h6>üìç ÏúÑÏπò ÏßÄÎèÑ</h6>
								<div id="map"
									style="width: 100%; height: 300px; border: 1px solid #ccc; border-radius: 10px;"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Ï£ºÎ¨∏Ìëú -->
				<div class="col-md-4">
					<div class="card order-summary p-3">
						<h5 class="card-title">üõí Ï£ºÎ¨∏Ìëú</h5>

						<div class="order-item-list mb-3">
							<!-- Ï£ºÎ¨∏ Î©îÎâ¥ Î∞è Ï∂îÍ∞Ä Î©îÎâ¥Í∞Ä Ïó¨Í∏∞ ÎèôÏ†ÅÏúºÎ°ú Îì§Ïñ¥Í∞ëÎãàÎã§ -->
						</div>

						<hr />
						<p>
							Ï¥ù Í∞ÄÍ≤©: <strong id="totalPrice">0Ïõê</strong><br /> <small
								class="text-muted">(Î∞∞Îã¨ÎπÑ Ìè¨Ìï®)</small>
						</p>

						<!-- ÏàòÎüâ Ï°∞Ï†à ÏòÅÏó≠ -->
						<div class="qty-control d-flex flex-row align-items-center mb-3">
							<button class="btn btn-outline-secondary btn-qty"
								onclick="minus()">‚àí</button>
							<span id="itemCount" class="mx-3">0</span>
							<button class="btn btn-outline-secondary btn-qty"
								onclick="plus()">Ôºã</button>
						</div>

						<!-- Ï£ºÎ¨∏ Ï¥àÍ∏∞Ìôî(ÏÇ≠Ï†ú) Î≤ÑÌäº -->
						<button class="btn btn-danger w-100 mb-2" id="btnRemoveItem">Ï£ºÎ¨∏
							Ï∑®ÏÜå</button>

						<button class="btn text-white w-100"
							style="background-color: #43d091;" id="btnOrderNow">
							Ï£ºÎ¨∏ÌïòÍ∏∞</button>
					</div>
				</div>


			</div>
		</div>

<form id="orderForm" method="post" action="/pay" style="display:none">
	<input type="hidden" name="menuId" id="orderMenuId">
	<input type="hidden" name="count" id="orderCount">
	<input type="hidden" name="optionIds" id="orderOptionIds">
	<input type="hidden" name="totalPrice" id="orderTotalPrice">
</form>

	</div>




<script src="/js/main.js"></script>
</body>
</html>

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.projectbob.mapper.LoginMapper" >
<insert id="joinMember" parameterType="Member">
	INSERT INTO client(id, pass, name, nickname, birthday, address1, address2, email, phone, division, reg_date, modi_date) 
	VALUES (#{id}, #{pass}, #{name}, #{nickname}, #{birthday}, #{address1}, #{address2}, #{email}, #{phone}, #{division}, SYSDATE(), SYSDATE())
</insert>

<select id="getMember" resultType="Member">
	SELECT *
	FROM client
	WHERE id = #{id}
</select>

<update id="updateMember" parameterType="Member">
	UPDATE client
	SET pass=#{pass}, nickname=#{nickname}, address1 = #{address1}, address2=#{address2}, email = #{email}, phone = #{phone}, modi_date = SYSDATE()
	WHERE id = #{id}
</update>

<delete id="deleteMember">
	DELETE FROM client
	WHERE id = #{id}
</delete>

<select id="searchId">
	SELECT id 
	FROM client
	WHERE name = #{name}
	<if test="receive == 'email'">
		and email = #{email}
	</if>
	<if test="receive == 'phone'">
		and phone = #{phone}
	</if>
</select>

<select id="searchPassword">
	SELECT pass
	FROM client
	WHERE  id = #{id}
	and    name = #{name}
	<if test="receive == 'email'">
		and email = #{email}
	</if>
	<if test="receive == 'phone'">
		and phone = #{phone}
	</if>
</select>

<select id="userList" resultType="Member">
	SELECT *
	FROM client
	<where>
    	<if test="division != null and division != ''">
        	division = #{division}
    	</if>
    	<if test="keyword != null and keyword != ''">
        	AND id LIKE CONCAT('%', #{keyword}, '%') 
    	</if>
</where>
	ORDER BY division, id
</select>

<update id="updateIsuse">
	UPDATE client
	SET isuse = #{isuse}
	WHERE id = #{id}
</update>

<select id="clientList" resultType="Member">
	select *
	from client
	where division = 'client'
</select>

<insert id="addBirthdayCoupon">
	INSERT INTO coupon(id, name, content, dis_price, min_price, reg_date, modi_date, del_date)
	VALUES (#{id}, CONCAT(YEAR(CURDATE()),'년 ', MONTH(CURDATE()),'월 ',DAY(CURDATE()),'일 생일 쿠폰'), '생일 축하드립니다.', 3000, 10000, SYSDATE(), SYSDATE(), DATE_ADD(SYSDATE(), INTERVAL 1 MONTH))
</insert>

<select id="checkbirthdayCoupon">
	SELECT * 
	FROM coupon
	WHERE id = #{id}
	AND name = CONCAT(YEAR(CURDATE()),'년 ', MONTH(CURDATE()),'월 ',DAY(CURDATE()),'일 생일 쿠폰')
</select>

</mapper>	



